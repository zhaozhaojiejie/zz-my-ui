(window.webpackJsonp=window.webpackJsonp||[]).push([[561,5],{1011:function(t,e,r){"use strict";var i=r(53),n=(r(198),r(124),r(85),r(52)),o=r(528),s=r(513),a=r(962),c=r(963),u=r(964),h=r(799),l=r(401),d={fill:"rgba(255, 255, 255, 0.5)",stroke:{color:"#409eff",width:2},circle:{radius:6,fill:"#409eff",stroke:{width:1,color:"#fff"}}},f={name:"spMapDraw",inject:["myMap"],render:function(){return this.$slots.default},props:{type:{type:String,default:"LineString",validator:function(t){return["Point","LineString","Polygon","Circle"].includes(t)}},brush:{type:[Object,Function]},effect:{type:[Object,Function],default:function(){return d}},manual:Boolean,options:Object},watch:{type:function(){this.manual||(this.finish(),this.draw(),this.modify())}},methods:{getStyle:function(t){return t?"function"==typeof t?t():Object(l.a)(t):null},init:function(t){if(!this.layer){var e=new s.a,r=this.getStyle(this.effect);this.layer=new o.a({source:e,style:r}),t.addLayer(this.layer),this.manual||(this.draw(),this.modify()),this.$emit("ready",this)}},draw:function(t){var e=this;if(this.layer){var r=this.layer.getSource(),i=this.getStyle(this.brush),o=this.type,s=this.myMap.map,u=new a.a(Object(n.a)(Object(n.a)({},this.options),{},{type:o,source:r,style:i}));this.drawStartHandler=function(t){e.$emit("drawstart",t)},this.drawEndHandler=function(r){t&&t(r),e.$emit("drawend",r)},u.on("drawstart",this.drawStartHandler),u.on("drawend",this.drawEndHandler),this.drawInstance=u,this.snapInstance=new c.a({source:r}),s.addInteraction(u),s.addInteraction(this.snapInstance)}},modify:function(t){var e=this;if(this.layer){var r=this.myMap.map,i=this.layer.getSource(),o=this.getStyle(this.brush),s=new u.a(Object(n.a)(Object(n.a)({},this.options),{},{source:i,style:o}));this.modifyStartHandler=function(t){e.$emit("modifystart",t)},this.modifyEndHandler=function(r){t&&t(r),e.$emit("modifyend",r)},s.on("modifystart",this.modifyStartHandler),s.on("modifyend",this.modifyEndHandler),this.modifyInstance=s,r.addInteraction(this.modifyInstance)}},finish:function(){var t=this.myMap.map;if(t){var e=this.drawInstance,r=this.modifyInstance;e&&(e.un("drawstart",this.drawStartHandler),e.un("drawend",this.drawEndHandler),e.dispose(),t.removeInteraction(e),t.removeInteraction(this.snapInstance),this.drawInstance=null),r&&(r.un("modifystart",this.modifyStartHandler),r.un("modifyend",this.modifyEndHandler),r.dispose(),t.removeInteraction(r),this.modifyInstance=null)}},dispose:function(){this.finish(),this.myMap.map&&this.layer&&this.myMap.map.removeLayer(this.layer)},getFeatures:function(){return this.layer?this.layer.getSource().getFeatures():[]},clear:function(){this.layer&&this.layer.getSource().clear()},removeFeature:function(t){this.layer.getSource().removeFeature(t)},addFeature:function(t){var e=[].concat(t);this.layer.getSource().addFeatures(e)},toJSON:function(){var t=this.getFeatures();return(new h.a).writeFeatures(t)},fromJSON:function(t){var e=(new h.a).readFeatures(t);this.addFeature(e)},writeFeature:function(t){return(new h.a).writeFeature(t)},readFeature:function(t){return(new h.a).writeFeature(t)}},created:function(){this.myMap.mapReady(this.init)},beforeDestroy:function(){this.dispose()}};e.a=Object(i.a)(f)},2499:function(t,e,r){"use strict";r(1)({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},3180:function(t,e,r){"use strict";r.r(e);r(2499);var i=r(636),n=r(1011),o=r(418),s=(r(381),r(355),r(361)),a=r.n(s),c=r(0),u=r(720),h={data:function(){return{mode:"finish"}},methods:{handleReady:function(){var t=Object(u.c)("__draw_feature__",u.a);t&&this.$refs.draw.fromJSON(t)},draw:function(){this.$refs.draw.finish(),this.$refs.draw.draw(),this.mode="draw"},modify:function(){this.$refs.draw.finish(),this.$refs.draw.modify(),this.mode="modify"},finish:function(){this.$refs.draw.finish(),this.mode="finish"},getFeatures:function(){var t=this.$refs.draw.getFeatures();alert("当前有"+t.length+"个图形")},clear:function(){this.$refs.draw.clear(),this.save()},save:function(){var t=this;this.$nextTick((function(){var e=t.$refs.draw.toJSON();Object(u.d)("__draw_feature__",e,u.a)}))}}};c.default.use(a.a),c.default.use(o.a),c.default.use(n.a),c.default.use(i.a);var l=h,d=r(18),f=Object(d.a)(l,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("sp-map",[r("sp-map-placement",{staticStyle:{padding:"10px"},attrs:{placement:"left-top"}},[r("el-button",{attrs:{size:"small",disabled:"draw"===t.mode},on:{click:t.draw}},[t._v("绘画模式")]),t._v(" "),r("el-button",{attrs:{size:"small",disabled:"modify"===t.mode},on:{click:t.modify}},[t._v("编辑模式")]),t._v(" "),r("el-button",{attrs:{size:"small",disabled:"finish"===t.mode},on:{click:t.finish}},[t._v("结束")]),t._v(" "),r("el-button",{attrs:{size:"small"},on:{click:t.getFeatures}},[t._v("获取图形")]),t._v(" "),r("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),r("el-button",{attrs:{size:"small"},on:{click:t.clear}},[t._v("清空")])],1),t._v(" "),r("sp-map-draw",{ref:"draw",attrs:{manual:""},on:{ready:t.handleReady}})],1)}),[],!1,null,null,null);e.default=f.exports},355:function(t,e,r){},361:function(t,e,r){t.exports=function(t){var e={};function r(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(i,n,function(e){return t[e]}.bind(null,n));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/dist/",r(r.s=97)}({0:function(t,e,r){"use strict";function i(t,e,r,i,n,o,s,a){var c,u="function"==typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=r,u._compiled=!0),i&&(u.functional=!0),o&&(u._scopeId="data-v-"+o),s?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(s)},u._ssrRegister=c):n&&(c=a?function(){n.call(this,this.$root.$options.shadowRoot)}:n),c)if(u.functional){u._injectStyles=c;var h=u.render;u.render=function(t,e){return c.call(e),h(t,e)}}else{var l=u.beforeCreate;u.beforeCreate=l?[].concat(l,c):[c]}return{exports:t,options:u}}r.d(e,"a",(function(){return i}))},97:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("button",{staticClass:"el-button",class:[t.type?"el-button--"+t.type:"",t.buttonSize?"el-button--"+t.buttonSize:"",{"is-disabled":t.buttonDisabled,"is-loading":t.loading,"is-plain":t.plain,"is-round":t.round,"is-circle":t.circle}],attrs:{disabled:t.buttonDisabled||t.loading,autofocus:t.autofocus,type:t.nativeType},on:{click:t.handleClick}},[t.loading?r("i",{staticClass:"el-icon-loading"}):t._e(),t.icon&&!t.loading?r("i",{class:t.icon}):t._e(),t.$slots.default?r("span",[t._t("default")],2):t._e()])};i._withStripped=!0;var n={name:"ElButton",inject:{elForm:{default:""},elFormItem:{default:""}},props:{type:{type:String,default:"default"},size:String,icon:{type:String,default:""},nativeType:{type:String,default:"button"},loading:Boolean,disabled:Boolean,plain:Boolean,autofocus:Boolean,round:Boolean,circle:Boolean},computed:{_elFormItemSize:function(){return(this.elFormItem||{}).elFormItemSize},buttonSize:function(){return this.size||this._elFormItemSize||(this.$ELEMENT||{}).size},buttonDisabled:function(){return this.disabled||(this.elForm||{}).disabled}},methods:{handleClick:function(t){this.$emit("click",t)}}},o=r(0),s=Object(o.a)(n,i,[],!1,null,null,null);s.options.__file="packages/button/src/button.vue";var a=s.exports;a.install=function(t){t.component(a.name,a)};e.default=a}})},381:function(t,e,r){},401:function(t,e,r){"use strict";r(54),r(124),r(365),r(199),r(55);var i=r(86),n=r(57),o=r(764),s=r(839),a=r(1185),c=r(1186),u=r(1866),h=r(1187),l=r(838),d={fill:o.a,text:s.a,stroke:a.a,circle:c.a,icon:u.a,regularShape:h.a,backgroundFill:o.a,backgroundStroke:a.a},f=[c.a,u.a,h.a];function p(t){return"object"===Object(n.a)(t)}function g(t,e,r){var i,n;if(null!=r)return t?["fill","backgroundFill"].includes(e)?(n=p(i=r)?i:{color:i},new o.a(n)):"text"===e?p(r)?_(r,t):r:_(r,t):r}function _(t,e){var r={};return Object.entries(t).forEach((function(t){var e=Object(i.a)(t,2),n=e[0],o=e[1],s=d[n];"font"===n&&(o="".concat(o," sans-serif")),r[f.includes(s)?"image":n]=g(s,n,o)})),new(e||l.c)(r)}e.a=_},418:function(t,e,r){"use strict";var i=r(53),n=(r(198),r(21),r(385),r(54),r(87),r(85),r(197),r(429),r(365),r(55),r(52)),o=r(86),s=r(600),a=r(555),c=r(533),u=r(534),h=r(474),l=r(528),d=r(513),f=r(460),p=r(360),g={name:"spMap",provide:function(){return{myMap:this}},props:{zoom:{type:Number,default:10},minZoom:{type:Number,default:1},maxZoom:{type:Number,default:20},center:{type:Array,default:function(){return[113.261999,23.130592]}},adapter:{type:[String,Object,Function],default:"Baidu"},projection:{type:String,default:"EPSG:4326"},width:{type:String,default:"100%"},height:{type:String,default:"400px"},dragPan:{type:Boolean,default:!0},mouseWheelZoom:{type:Boolean,default:!0},mapOptions:Object,viewOptions:Object,invert:Boolean,filter:Object},render:function(){var t=arguments[0];return t("div",{class:this.classes,style:this.styles},[this.$slots.default])},data:function(){return{cursor:null,viewWidth:0,viewHeight:0}},computed:{classes:function(){return{"sp-map":!0,"sp-map--invert":this.invert}},styles:function(){return{width:this.width,height:this.height,cursor:this.cursor?"pointer":""}},filterStyle:function(){return this.filter?Object.entries(this.filter).map((function(t){var e=Object(o.a)(t,2),r=e[0],i=e[1];return"hue-rotate"===r?"".concat(r,"(").concat(i,"deg)"):"".concat(r,"(").concat(i,")")})).join(" "):null}},watch:{dragPan:function(t){this.setActive(c.a,t)},mouseWheelZoom:function(t){this.setActive(u.a,t)},filterStyle:function(){this.setCanvasFilter()}},methods:{setActive:function(t,e){if(this.map){var r=this.map.getInteractions().getArray().find((function(e){return e instanceof t}));r&&r.setActive(e)}},init:function(){var t=this.$props,e=t.center,r=t.projection,i=t.zoom,o=t.minZoom,l=t.maxZoom,d=Object(f.a)(this.adapter);d.__MY_LAYER__=!0;var g=new a.a(Object(n.a)(Object(n.a)({},this.viewOptions||{}),{},{projection:r,center:e,zoom:i,minZoom:o,maxZoom:l}));this.map=new s.a(Object(n.a)(Object(n.a)({},this.mapOptions||{}),{},{layers:[].concat(d),view:g,target:this.$el,controls:[],interactions:[new c.a,new u.a,new h.b({handleEvent:this.handleEvent})]})),this.setActive(c.a,this.dragPan),this.setActive(u.a,this.mouseWheelZoom),this.bindMapEvents(),this.$emit("ready",this.map,this),Object(p.addResizeListener)(this.$el,this.setViewSize),this.setCanvasFilter()},dispose:function(){this.map&&(this.map.disposeInternal(),this.unbindMapEvents(),Object(p.removeResizeListener)(this.$el,this.setViewSize))},getFeatureAtPixel:function(t){return this.map?this.map.forEachFeatureAtPixel(t,(function(t){return t})):null},setCursor:function(t){var e=this.getFeatureVM(t);this.cursor=e&&(e.cursor||e.$listeners.click)},clickTrigger:function(t,e){if(t){var r=this.getFeatureVM(t);r&&r.$emit("click",e,t)}},getLayer:function(){return this.map?this.map.getLayers().getArray().find((function(t){return t.__MY_LAYER__})):null},getFeatureVM:function(t){if(t){var e=(t.get("features")||[])[0]||t;return e.__vm__||e.get("__vm__")}},enterAndLeaveTrigger:function(t,e){if(!this.featureAtPixel&&t){this.$emit("mouseenter",e,t);var r=this.getFeatureVM(t);r&&r.$emit("mouseenter",e,t)}if(this.featureAtPixel&&!t){this.$emit("mouseleave",e,this.featureAtPixel);var i=this.getFeatureVM(this.featureAtPixel);i&&i.$emit("mouseleave",e,this.featureAtPixel)}if(this.featureAtPixel&&t&&this.featureAtPixel!==t){this.$emit("mouseleave",e,this.featureAtPixel),this.$emit("mouseenter",e,t);var n=this.getFeatureVM(this.featureAtPixel);n&&n.$emit("mouseleave",e,this.featureAtPixel);var o=this.getFeatureVM(t);o&&o.$emit("mouseenter",e,t)}this.featureAtPixel=t},handleEvent:function(t){var e=t.type,r=this.getFeatureAtPixel(t.pixel);switch(e){case"pointermove":this.setCursor(r),this.enterAndLeaveTrigger(r,t);break;case"click":this.clickTrigger(r,t)}return!0},bindMapEvents:function(){var t=this;this.map&&Object.entries(this.$listeners).forEach((function(e){var r=Object(o.a)(e,2),i=r[0],n=r[1];return t.map.on(i,n)}))},unbindMapEvents:function(){var t=this;this.map&&Object.entries(this.$listeners).forEach((function(e){var r=Object(o.a)(e,2),i=r[0],n=r[1];return t.map.un(i,n)}))},resize:function(){this.map.updateSize()},moveTo:function(t){this.map&&this.map.getView().animate({center:t,duration:200})},zoomTo:function(t){this.map&&this.map.getView().animate({zoom:Number.parseInt(t),duration:200})},zoomIn:function(){if(this.map){var t=this.map.getView();this.zoomTo(t.getZoom()+1)}},zoomOut:function(){if(this.map){var t=this.map.getView();this.zoomTo(t.getZoom()-1)}},mapReady:function(t){this.map?t&&t(this.map,this):this.$once("ready",t)},createVectorLayer:function(){if(this.map&&!this.vectorLayer){var t=new d.a;return this.vectorLayer=new l.a({source:t,zIndex:1}),this.map.addLayer(this.vectorLayer),this.vectorLayer}},addFeature:function(t){if(this.map){this.vectorLayer||this.createVectorLayer();var e=this.vectorLayer.getSource(),r=[].concat(t);e.addFeatures(r)}},removeFeature:function(t){if(this.vectorLayer){var e=this.vectorLayer.getSource();[].concat(t).forEach((function(t){return e.removeFeature(t)}))}},getMetersPerUnit:function(){return this.map?this.map.getView().getProjection().getMetersPerUnit():0},setViewSize:function(){var t=this.$el.getBoundingClientRect();this.viewWidth=t.width||0,this.viewHeight=t.height||0,this.map&&this.map.updateSize(),this.$emit("viewSizeChange",t)},setCanvasFilter:function(){if(this.map){var t=this.map.getViewport();t&&(t.style.filter=this.filterStyle)}},clear:function(){this.map&&this.map.getLayers().getArray().filter((function(t){return!t.__MY_LAYER__})).forEach((function(t){t.getSource().clear()}))}},mounted:function(){this.init()},beforeDestroy:function(){this.dispose()}};r(597),r(468),e.a=Object(i.a)(g)},428:function(t,e,r){"use strict";r.d(e,"c",(function(){return s})),r.d(e,"d",(function(){return a})),r.d(e,"a",(function(){return c})),r.d(e,"b",(function(){return u}));r(54),r(87),r(32),r(482),r(33),r(88),r(430),r(58),r(503),r(402);var i=r(480),n=r.n(i),o=/^(http|https):\/\/[\w.:]*\//;function s(t,e,r){var i,n={};t=(t||location.search).replace(/^[^]*\?/,""),e=e||"&",r=r||"=";for(var o=new RegExp("(?:^|\\"+e+")([^\\"+r+"\\"+e+"]+)(?:\\"+r+"([^\\"+e+"]*))?","g");null!==(i=o.exec(t));)i[1]!==t&&(n[decodeURIComponent(i[1])]=decodeURIComponent(i[2]||""));return n}function a(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push([r,encodeURIComponent(t[r])].join("="));return e.join("&")}function c(t){var e=t.match(o);return e?e[0]:""}function u(t,e){var r=[],i=c(t),o=n()(t.replace(i,""),r).exec(e.split("?")[0].replace(i,"")),s={};return o&&o.length>0&&r.forEach((function(t,e){s[t.name]=o[e+1]})),s}},460:function(t,e,r){"use strict";r.d(e,"a",(function(){return Q}));r(198),r(85);var i=r(52),n=r(57),o=r(462),s=r(591),a=r(598),c=r(457),u=r(602),h=r(548),l=r(404),d=r(590),f=(r(87),r(32),r(7),r(88),r(27)),p=r(60),g=r(129),_=r(130),y=r(132),m=r(131),v=r(481),b=r(535),O="METER",j="KILOMETER",C="DEGREE",w="INCH",x="FOOT",F="ISERVER";function P(t,e,r){var i=t*e*(1/.0254)*function(t){var e;if(t===O)e=1;else if(t===C)e=2*Math.PI*6378137/360;else if(t===j)e=.001;else if(t===w)e=1/.025399999918;else{if(t!==x)return e;e=.3048}return e}(r);return i=1/i}function E(t,e,r){var i=t*e*(1/.0254)*this.getMeterPerMapUnit(r);return i=1/i}var S=function(t){Object(y.a)(r,t);var e=Object(m.a)(r);function r(t){var i;if(Object(f.a)(this,r),void 0===(t=t||{}).url)return Object(g.a)(i);t.format=t.format?t.format:"png";var n=t.url+"/tileImage."+t.format+"?";t.serverType=t.serverType||F,i=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,logo:t.logo,opaque:t.opaque,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:function(e,i,n){o.tileGrid||(o.extent?(o.tileGrid=r.createTileGrid(t.extent),o.resolutions&&(o.tileGrid.resolutions=o.resolutions)):("EPSG:3857"===n.getCode()&&(o.tileGrid=r.createTileGrid([-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892]),o.extent=[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892]),"EPSG:4326"===n.getCode()&&(o.tileGrid=r.createTileGrid([-180,-90,180,90]),o.extent=[-180,-90,180,90])));o.origin=o.tileGrid.getOrigin(0);var s=e[0],c=e[1],u=-e[2]-1,h=o.tileGrid.getResolution(s),l=n.getUnits();"degrees"===l&&(l=C);"m"===l&&(l=O);var d=P(h,96,l),f=Object(v.c)(o.tileGrid.getTileSize(s,o.tmpSize)),p=a.call(o)+encodeURI("&x="+c+"&y="+u+"&width="+f[0]+"&height="+f[1]+"&scale="+d);o.tileProxy&&(p=o.tileProxy+encodeURIComponent(p));o.cacheEnabled||(p+="&_t="+(new Date).getTime());return p},url:t.url,urls:t.urls,wrapX:void 0!==t.wrapX&&t.wrapX,cacheEnabled:t.cacheEnabled,layersID:t.layersID}),t.tileProxy&&(i.tileProxy=t.tileProxy),i.options=t,i._url=t.url,i.tileSetsIndex=-1,i.tempIndex=-1;var o=Object(_.a)(i);function s(){var e={};return e.redirect=void 0!==t.redirect&&t.redirect,e.transparent=void 0===t.transparent||t.transparent,e.cacheEnabled=!(!1===t.cacheEnabled),this.cacheEnabled=e.cacheEnabled,e._cache=e.cacheEnabled,this.origin&&(e.origin=JSON.stringify({x:this.origin[0],y:this.origin[1]})),t.prjCoordSys&&(e.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(e.layersID=t.layersID.toString()),t.overlapDisplayed?e.overlapDisplayed=!0:(e.overlapDisplayed=!1,t.overlapDisplayedOptions&&(e.overlapDisplayedOptions=this.overlapDisplayedOptions.toString())),t.cacheEnabled&&t.tileversion&&(e.tileversion=t.tileversion.toString()),e}function a(){return this._paramsChanged&&(this._layerUrl=c.call(this),this._paramsChanged=!1),this._layerUrl||c.call(this)}function c(){return this._layerUrl=n+encodeURI(u.call(this)),this._layerUrl}function u(){this.requestParams=this.requestParams||s.call(this);var t=[];for(var e in this.requestParams)t.push(e+"="+this.requestParams[e]);return t.join("&")}return i}return Object(p.a)(r,[{key:"setTileSetsInfo",value:function(t){this.tileSets=t,Array.isArray(this.tileSets)&&(this.tileSets=t[0]),this.tileSets&&(this.dispatchEvent({type:"tilesetsinfoloaded",value:{tileVersions:this.tileSets.tileVersions}}),this.changeTilesVersion())}},{key:"lastTilesVersion",value:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()}},{key:"nextTilesVersion",value:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()}},{key:"changeTilesVersion",value:function(){var t=this;if(null!=t.tileSets&&!(t.tempIndex===t.tileSetsIndex||this.tempIndex<0)){var e=t.tileSets.tileVersions;if(e&&t.tempIndex<e.length&&t.tempIndex>=0){var r=e[t.tempIndex].name;t.mergeTileVersionParam(r)&&(t.tileSetsIndex=t.tempIndex,t.dispatchEvent({type:"tileversionschanged",value:{tileVersion:e[t.tempIndex]}}))}}}},{key:"updateCurrentTileSetsIndex",value:function(t){this.tempIndex=t}},{key:"mergeTileVersionParam",value:function(t){return!!t&&(this.requestParams.tileversion=t,this._paramsChanged=!0,this.refresh(),!0)}}],[{key:"optionsFromMapJSON",value:function(t,e){var r={};r.url=t,r.crossOrigin="anonymous";var i=[e.bounds.left,e.bounds.bottom,e.bounds.right,e.bounds.top],n=function(){var t,r=i[2]-i[0],n=i[3]-i[1],o=r>=n?r:n;t=o===r?o/e.viewer.width:o/e.viewer.height;var s=[],a=O;e.coordUnit===C&&(a=C);if(e.visibleScalesEnabled&&e.visibleScales&&e.visibleScales.length>0)for(var c=0;c<e.visibleScales.length;c++)s.push(E(e.visibleScales[c],96,a));else for(var u=0;u<17;u++)s.push(t/Math.pow(2,u));return s.sort((function(t,e){return e-t}))}();return r.tileGrid=new l.a({extent:i,resolutions:n}),r}},{key:"createTileGrid",value:function(t,e,r,i,n){var o=Object(b.a)({extent:t,maxZoom:e,minZoom:r,tileSize:i});return new l.a({extent:t,minZoom:r,origin:n,resolutions:o.getResolutions(),tileSize:o.getTileSize()})}}]),r}(h.a),T=r(363),I=r(383),G=r(428),M=(r(33),r(58),r(599)),L=r.n(M),R=new I.b({code:"baidu",extent:[-20037726.37,-12474104.17,20037726.37,12474104.17],units:"m"});Object(I.d)(R),Object(I.c)("EPSG:4326",R,L.a.ll2bmerc,L.a.bmerc2ll),Object(I.c)("EPSG:3857",R,L.a.smerc2bmerc,L.a.bmerc2smerc);for(var k=new Array(19),N=0;N<19;++N)k[N]=Math.pow(2,18-N);var A=function(t){return new o.a({source:new c.a({projection:"baidu",maxZoom:18,tileUrlFunction:function(e){var r=e[1],i=-e[2]-1,n=e[0];r<0&&(r="M"+-r),i<0&&(i="M"+-i);var o=Math.ceil(5*Math.random());return t.url.replace(/{x}/g,r).replace(/{y}/g,i).replace(/{z}/g,n).replace(/{n}/g,o)},tileGrid:new l.a({resolutions:k,origin:[0,0]})})})},D="http://webrd03.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}&lang=zh_cn",V="http://online{n}.map.bdimg.com/tile/?qt=vtile&x={x}&y={y}&z={z}&styles=pl&scaler=1&udt=20190718",U="http://10.8.6.103/PGIS_S_TileMapServer/Maps/BJSL/EzMap?Service=getImage&Type=RGB&ZoomOffset=0",z="http://53.1.238.17/iserver/services/map-pgisvec/rest/maps/pgisvecv1",$="http://68.26.21.71/images/GetImage.do?method=showImageRedisBytable&jinyi_admin:MA_PGISSLDT&version=v1";function B(){for(var t=[],e=0;e<20;e++){var r=e<7?[64,64]:[107.5,28];t.push(r)}return t}function Y(){for(var t=[],e=0;e<20;e++){var r=2.0000081722216954/Math.pow(2,e);t.push(r)}return t}function H(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EPSG:4326",e=256,r=Object(I.j)(t),i=r.getExtent(),n=Object(T.E)(i)/e,o=[],s=[],a=0;a<=20;a++)o[a]=a,s[a]=n/Math.pow(2,a);return new d.b({origin:Object(T.C)(i),resolutions:s,matrixIds:o})}function X(t){var e=t.layers.map((function(t){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vec_c";return new o.a({source:new c.a({url:"http://t{0-7}.tianditu.com/DataServer?T="+t+"&x={x}&y={y}&l={z}&tk=464554f64aa4f4e90e0321c17a57a331"})})}(t)}));return new s.a({layers:e})}function q(t){var e=H(),r=t.url;return new o.a({source:new u.a({url:r,tileGrid:e}),wrapX:!1})}function W(t){var e=t.url,r=H();return new o.a({source:new u.a({url:"",crossOrigin:"Anonymous",tileGrid:r,tileLoadFunction:function(t,r){var i=Object(G.c)(r),n={Row:i.TileRow,Col:i.TileCol,Zoom:i.TileMatrix,V:"1.0.0"};t.getImage().src="".concat(e,"&").concat(Object(G.d)(n))}}),wrapX:!1})}function Z(t){if("function"==typeof t.url){var e=t.url,r=H();return new o.a({source:new u.a({url:"",crossOrigin:"Anonymous",tileGrid:r,tileLoadFunction:function(t,r){var i=Object(G.c)(r);t.getImage().src=e(i)}}),wrapX:!1})}return W(t)}function J(t){return new o.a({source:new S({url:t.url}),projection:t.projection||"EPSG:4326"})}function K(t){var e=t.url;return new o.a({projection:t.projection||"EPSG:4326",url:"".concat(e,"&l={z}&x={y}&y={x}"),tileGrid:new l.a({origin:t.origins||B(),resolutions:t.resolutions||Y()})})}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof t)return t({TileLayer:o.a,LayerGroup:s.a,OSM:a.a,XYZ:c.a,WMTS:u.a,TileImage:h.a,TileGrid:l.a,WMTSGrid:d.b,getWidth:T.E,getTopLeft:T.C,getProj:I.j});var r="object"===Object(n.a)(t)?Object(i.a)({},t):{type:t},f=r.type;switch(delete r.type,f){case"OSM":return new o.a(Object(i.a)(Object(i.a)({},e),{},{source:new a.a(r)}));case"XYZ":return new o.a(Object(i.a)(Object(i.a)({},e),{},{source:new c.a(r)}));case"Amap":return new o.a(Object(i.a)(Object(i.a)({},e),{},{source:new c.a(Object(i.a)({url:D},r))}));case"Baidu":return A(Object(i.a)({url:V},r));case"TDT":return X(Object(i.a)({layers:["vec_c","vec_w","cva_w","ibo_w"]},r));case"Founder":return q(Object(i.a)({url:"http://127.0.0.1:3000/proxy"},r));case"Ez":return W(Object(i.a)({url:U},r));case"Super":return J(Object(i.a)({url:z},r));case"Fc":return K(Object(i.a)({url:$},r));case"WMTS":return Z(r)}}},468:function(t,e,r){},512:function(t,e,r){"use strict";var i,n=r(536),o=r(408),s=r(500),a=r(545),c=r(363),u=r(509),h=r(537),l=r(407),d=r(694),f=r(510),p=r(525),g=r(592),_=r(695),y=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),m=function(t){function e(e,r){var i=t.call(this)||this;return i.flatMidpoint_=null,i.flatMidpointRevision_=-1,i.maxDelta_=-1,i.maxDeltaRevision_=-1,void 0===r||Array.isArray(e[0])?i.setCoordinates(e,r):i.setFlatCoordinates(r,e),i}return y(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?Object(l.c)(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,i){return i<Object(c.e)(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(a.e)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(a.d)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,i))},e.prototype.forEachSegment=function(t){return Object(d.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=n.a.XYM&&this.layout!=n.a.XYZM)return null;var r=void 0!==e&&e;return Object(p.b)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)},e.prototype.getCoordinates=function(){return Object(f.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return Object(p.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return Object(_.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[];return r.length=Object(h.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r,0),new e(r,n.a.XY)},e.prototype.getType=function(){return o.a.LINE_STRING},e.prototype.intersectsExtent=function(t){return Object(g.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Object(u.b)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(s.a);e.a=m},525:function(t,e,r){"use strict";r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return a}));var i=r(407),n=r(450);function o(t,e,r,o,s,a,c){var u,h,l=(r-e)/o;if(1===l)u=e;else if(2===l)u=e,h=s;else if(0!==l){for(var d=t[e],f=t[e+1],p=0,g=[0],_=e+o;_<r;_+=o){var y=t[_],m=t[_+1];p+=Math.sqrt((y-d)*(y-d)+(m-f)*(m-f)),g.push(p),d=y,f=m}var v=s*p,b=Object(i.a)(g,v);b<0?(h=(v-g[-b-2])/(g[-b-1]-g[-b-2]),u=e+(-b-2)*o):u=e+b*o}var O=c>1?c:2,j=a||new Array(O);for(_=0;_<O;++_)j[_]=void 0===u?NaN:void 0===h?t[u+_]:Object(n.c)(t[u+_],t[u+o+_],h);return j}function s(t,e,r,i,o,s){if(r==e)return null;var a;if(o<t[e+i-1])return s?((a=t.slice(e,e+i))[i-1]=o,a):null;if(t[r-1]<o)return s?((a=t.slice(r-i,r))[i-1]=o,a):null;if(o==t[e+i-1])return t.slice(e,e+i);for(var c=e/i,u=r/i;c<u;){var h=c+u>>1;o<t[(h+1)*i-1]?u=h:c=h+1}var l=t[c*i-1];if(o==l)return t.slice((c-1)*i,(c-1)*i+i);var d=(o-l)/(t[(c+1)*i-1]-l);a=[];for(var f=0;f<i-1;++f)a.push(Object(n.c)(t[(c-1)*i+f],t[c*i+f],d));return a.push(o),a}function a(t,e,r,i,n,o,a){if(a)return s(t,e,r[r.length-1],i,n,o);var c;if(n<t[i-1])return o?((c=t.slice(0,i))[i-1]=n,c):null;if(t[t.length-1]<n)return o?((c=t.slice(t.length-i))[i-1]=n,c):null;for(var u=0,h=r.length;u<h;++u){var l=r[u];if(e!=l){if(n<t[e+i-1])return null;if(n<=t[l-1])return s(t,e,l,i,n,!1);e=l}}return null}},636:function(t,e,r){"use strict";var i=r(53),n=(r(198),r(124),r(87),r(85),r(197),{name:"spMapPlacement",props:{placement:{type:String,default:"left-bottom",validator:function(t){return["left-top","center-top","right-top","left-center","center-center","right-center","left-bottom","center-bottom","right-bottom"].includes(t)}},zIndex:{type:Number,default:1},margin:{type:[Array,Number],default:10},theme:{type:String,default:"light",validator:function(){return["light","dark"]}}},computed:{styles:function(){return{zIndex:this.zIndex,margin:[].concat(this.margin).map((function(t){return"".concat(t,"px")})).join(" ")}},classes:function(){return["is-".concat(this.theme),this.placement]}}}),o=r(18),s=Object(o.a)(n,(function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"sp-map-placement",class:this.classes,style:this.styles},[this._t("default")],2)}),[],!1,null,null,null).exports;r(640),e.a=Object(i.a)(s)},640:function(t,e,r){},647:function(t,e,r){"use strict";var i,n=r(408),o=r(477),s=r(500),a=r(363),c=r(509),u=r(407),h=r(510),l=r(450),d=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),f=function(t){function e(e,r){var i=t.call(this)||this;return r&&!Array.isArray(e[0])?i.setFlatCoordinates(r,e):i.setCoordinates(e,r),i}return d(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?Object(u.c)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,r,i){if(i<Object(a.e)(this.getExtent(),t,e))return i;for(var n=this.flatCoordinates,o=this.stride,s=0,c=n.length;s<c;s+=o){var u=Object(l.g)(t,e,n[s],n[s+1]);if(u<i){i=u;for(var h=0;h<o;++h)r[h]=n[s+h];r.length=o}}return i},e.prototype.getCoordinates=function(){return Object(h.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new o.a(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,i=[],n=0,s=t.length;n<s;n+=r){var a=new o.a(t.slice(n,n+r),e);i.push(a)}return i},e.prototype.getType=function(){return n.a.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,r=this.stride,i=0,n=e.length;i<n;i+=r){var o=e[i],s=e[i+1];if(Object(a.h)(t,o,s))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Object(c.b)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(s.a);e.a=f},720:function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"a",(function(){return o})),r.d(e,"d",(function(){return s})),r.d(e,"c",(function(){return a}));var i=r(57),n=window.sessionStorage||{},o=window.localStorage||{};function s(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n,o="object"===Object(i.a)(e)?JSON.stringify(e):e;r.setItem(t,o)}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,r=e.getItem(t);if(r){if("object"===Object(i.a)(r))return r;var o=/^({[\W\w]*})|(\[[\W\w]*])$/;return o.test(r)?JSON.parse(r):r}return null}},735:function(t,e,r){"use strict";var i,n=r(536),o=r(408),s=r(512),a=r(500),c=r(545),u=r(363),h=r(509),l=r(537),d=r(407),f=r(510),p=r(525),g=r(592),_=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),y=function(t){function e(e,r,i){var n=t.call(this)||this;if(n.ends_=[],n.maxDelta_=-1,n.maxDeltaRevision_=-1,Array.isArray(e[0]))n.setCoordinates(e,r);else if(void 0!==r&&i)n.setFlatCoordinates(r,e),n.ends_=i;else{for(var o=n.getLayout(),s=e,a=[],c=[],u=0,h=s.length;u<h;++u){var l=s[u];0===u&&(o=l.getLayout()),Object(d.c)(a,l.getFlatCoordinates()),c.push(a.length)}n.setFlatCoordinates(o,a),n.ends_=c}return n}return _(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?Object(d.c)(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,r,i){return i<Object(u.e)(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(c.a)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(c.b)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,i))},e.prototype.getCoordinateAtM=function(t,e,r){if(this.layout!=n.a.XYM&&this.layout!=n.a.XYZM||0===this.flatCoordinates.length)return null;var i=void 0!==e&&e,o=void 0!==r&&r;return Object(p.c)(this.flatCoordinates,0,this.ends_,this.stride,t,i,o)},e.prototype.getCoordinates=function(){return Object(f.b)(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new s.a(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,r=this.layout,i=[],n=0,o=0,a=e.length;o<a;++o){var c=e[o],u=new s.a(t.slice(n,c),r);i.push(u),n=c}return i},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,r=0,i=this.ends_,n=this.stride,o=0,s=i.length;o<s;++o){var a=i[o],c=Object(p.a)(e,r,a,n,.5);Object(d.c)(t,c),r=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],i=[];return r.length=Object(l.b)(this.flatCoordinates,0,this.ends_,this.stride,t,r,0,i),new e(r,n.a.XY,i)},e.prototype.getType=function(){return o.a.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return Object(g.b)(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=Object(h.c)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()},e}(a.a);e.a=y},736:function(t,e,r){"use strict";var i=r(536),n=r(408),o=r(647),s=r(596),a=r(500),c=r(545),u=r(363),h=r(509),l=r(407),d=r(834),f=r(510),p=r(592),g=r(851),_=r(806);var y,m=r(760),v=r(537),b=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),O=function(t){function e(e,r,i){var n=t.call(this)||this;if(n.endss_=[],n.flatInteriorPointsRevision_=-1,n.flatInteriorPoints_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,!i&&!Array.isArray(e[0])){for(var o=n.getLayout(),s=e,a=[],c=[],u=0,h=s.length;u<h;++u){var d=s[u];0===u&&(o=d.getLayout());for(var f=a.length,p=d.getEnds(),g=0,_=p.length;g<_;++g)p[g]+=f;Object(l.c)(a,d.getFlatCoordinates()),c.push(p)}r=o,e=a,i=c}return void 0!==r&&i?(n.setFlatCoordinates(r,e),n.endss_=i):n.setCoordinates(e,r),n}return b(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var r=this.flatCoordinates.length;Object(l.c)(this.flatCoordinates,t.getFlatCoordinates());for(var i=0,n=(e=t.getEnds().slice()).length;i<n;++i)e[i]+=r}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,r=new Array(t),i=0;i<t;++i)r[i]=this.endss_[i].slice();return new e(this.flatCoordinates.slice(),this.layout,r)},e.prototype.closestPointXY=function(t,e,r,i){return i<Object(u.e)(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(c.f)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(c.c)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,r,i))},e.prototype.containsXY=function(t,e){return Object(m.d)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return Object(_.c)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Object(g.d)(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Object(f.c)(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,r,i){for(var n=[],o=Object(u.j)(),s=0,a=r.length;s<a;++s){var c=r[s];o=Object(u.o)(t,e,c[0],i),n.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=c[c.length-1]}return n}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Object(d.b)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new o.a(this.getFlatInteriorPoints().slice(),i.a.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Object(g.b)(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Object(g.d)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var r=[],n=[];return r.length=Object(v.d)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),r,0,n),new e(r,i.a.XY,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var r=this.endss_[t-1];e=r[r.length-1]}var i=this.endss_[t].slice(),n=i[i.length-1];if(0!==e)for(var o=0,a=i.length;o<a;++o)i[o]-=e;return new s.a(this.flatCoordinates.slice(e,n),this.layout,i)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,r=this.endss_,i=[],n=0,o=0,a=r.length;o<a;++o){var c=r[o].slice(),u=c[c.length-1];if(0!==n)for(var h=0,l=c.length;h<l;++h)c[h]-=n;var d=new s.a(e.slice(n,u),t,c);i.push(d),n=u}return i},e.prototype.getType=function(){return n.a.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return Object(p.d)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=Object(h.d)(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var i=r[r.length-1];this.flatCoordinates.length=0===i.length?0:i[i.length-1]}this.changed()},e}(a.a);e.a=O},799:function(t,e,r){"use strict";var i,n=r(467),o=r(422),s=r(835),a=r(408),c=r(363),u=r(476),h=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function l(t){for(var e=[],r=0,i=t.length;r<i;++r)e.push(t[r].clone());return e}var d=function(t){function e(e){var r=t.call(this)||this;return r.geometries_=e||null,r.changeEventsKeys_=[],r.listenGeometriesChange_(),r}return h(e,t),e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(u.c),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(Object(u.a)(this.geometries_[t],o.a.CHANGE,this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t},e.prototype.closestPointXY=function(t,e,r,i){if(i<Object(c.e)(this.getExtent(),t,e))return i;for(var n=this.geometries_,o=0,s=n.length;o<s;++o)i=n[o].closestPointXY(t,e,r,i);return i},e.prototype.containsXY=function(t,e){for(var r=this.geometries_,i=0,n=r.length;i<n;++i)if(r[i].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){Object(c.l)(t);for(var e=this.geometries_,r=0,i=e.length;r<i;++r)Object(c.q)(t,e[r].getExtent());return t},e.prototype.getGeometries=function(){return l(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,r=0,i=e.length;r<i;++r)e[r].getType()===this.getType()?t=t.concat(e[r].getGeometriesArrayRecursive()):t.push(e[r]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var r=[],i=this.geometries_,n=!1,o=0,s=i.length;o<s;++o){var a=i[o],c=a.getSimplifiedGeometry(t);r.push(c),c!==a&&(n=!0)}if(n){var u=new e(null);return u.setGeometriesArray(r),u}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return a.a.GEOMETRY_COLLECTION},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,r=0,i=e.length;r<i;++r)if(e[r].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var r=this.geometries_,i=0,n=r.length;i<n;++i)r[i].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,r){var i=r;i||(i=Object(c.x)(this.getExtent()));for(var n=this.geometries_,o=0,s=n.length;o<s;++o)n[o].scale(t,e,i);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(l(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,r=0,i=e.length;r<i;++r)e[r].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var r=this.geometries_,i=0,n=r.length;i<n;++i)r[i].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(s.a),f=r(639),p=r(431),g=r(472),_=r(383),y=function(){function t(){this.dataProjection=null,this.defaultFeatureProjection=null}return t.prototype.getReadOptions=function(t,e){var r;if(e){var i=e.dataProjection?Object(_.j)(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()===f.b.TILE_PIXELS&&(i=Object(_.j)(i)).setWorldExtent(e.extent),r={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(r)},t.prototype.adaptOptions=function(t){return Object(g.a)({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return Object(p.b)()},t.prototype.readFeature=function(t,e){return Object(p.b)()},t.prototype.readFeatures=function(t,e){return Object(p.b)()},t.prototype.readGeometry=function(t,e){return Object(p.b)()},t.prototype.readProjection=function(t){return Object(p.b)()},t.prototype.writeFeature=function(t,e){return Object(p.b)()},t.prototype.writeFeatures=function(t,e){return Object(p.b)()},t.prototype.writeGeometry=function(t,e){return Object(p.b)()},t}();function m(t,e,r){var i,n=r?Object(_.j)(r.featureProjection):null,o=r?Object(_.j)(r.dataProjection):null;if(i=n&&o&&!Object(_.f)(n,o)?(e?t.clone():t).transform(e?n:o,e?o:n):t,e&&r&&void 0!==r.decimals){var s=Math.pow(10,r.decimals);i===t&&(i=t.clone()),i.applyTransform((function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*s)/s;return t}))}return i}var v=r(836),b=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}();function O(t){if("string"==typeof t){var e=JSON.parse(t);return e||null}return null!==t?t:null}var j=function(t){function e(){return t.call(this)||this}return b(e,t),e.prototype.getType=function(){return v.a.JSON},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(O(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(O(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return Object(p.b)()},e.prototype.readFeaturesFromObject=function(t,e){return Object(p.b)()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(O(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return Object(p.b)()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(O(t))},e.prototype.readProjectionFromObject=function(t){return Object(p.b)()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return Object(p.b)()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return Object(p.b)()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return Object(p.b)()},e}(y),C=r(512),w=r(735),x=r(647),F=r(736),P=r(477),E=r(596),S=r(473),T=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function i(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),I=function(t){function e(e){var r=this,i=e||{};return(r=t.call(this)||this).dataProjection=Object(_.j)(i.dataProjection?i.dataProjection:"EPSG:4326"),i.featureProjection&&(r.defaultFeatureProjection=Object(_.j)(i.featureProjection)),r.geometryName_=i.geometryName,r.extractGeometryName_=i.extractGeometryName,r}return T(e,t),e.prototype.readFeatureFromObject=function(t,e){var r=null,i=G((r="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),o=new n.a;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&o.setGeometryName(r.geometry_name),o.setGeometry(i),"id"in r&&o.setId(r.id),r.properties&&o.setProperties(r.properties,!0),o},e.prototype.readFeaturesFromObject=function(t,e){var r=null;if("FeatureCollection"===t.type){r=[];for(var i=t.features,n=0,o=i.length;n<o;++n)r.push(this.readFeatureFromObject(i[n],e))}else r=[this.readFeatureFromObject(t,e)];return r},e.prototype.readGeometryFromObject=function(t,e){return G(t,e)},e.prototype.readProjectionFromObject=function(t){var e,r=t.crs;return r?"name"==r.type?e=Object(_.j)(r.properties.name):"EPSG"===r.type?e=Object(_.j)("EPSG:"+r.properties.code):Object(S.a)(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var r={type:"Feature",geometry:null,properties:null},i=t.getId();if(void 0!==i&&(r.id=i),!t.hasProperties())return r;var n=t.getProperties(),o=t.getGeometry();return o&&(r.geometry=M(o,e),delete n[t.getGeometryName()]),Object(g.d)(n)||(r.properties=n),r},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var r=[],i=0,n=t.length;i<n;++i)r.push(this.writeFeatureObject(t[i],e));return{type:"FeatureCollection",features:r}},e.prototype.writeGeometryObject=function(t,e){return M(t,this.adaptOptions(e))},e}(j);function G(t,e){if(!t)return null;var r;switch(t.type){case a.a.POINT:r=function(t){return new P.a(t.coordinates)}(t);break;case a.a.LINE_STRING:r=function(t){return new C.a(t.coordinates)}(t);break;case a.a.POLYGON:r=function(t){return new E.a(t.coordinates)}(t);break;case a.a.MULTI_POINT:r=function(t){return new x.a(t.coordinates)}(t);break;case a.a.MULTI_LINE_STRING:r=function(t){return new w.a(t.coordinates)}(t);break;case a.a.MULTI_POLYGON:r=function(t){return new F.a(t.coordinates)}(t);break;case a.a.GEOMETRY_COLLECTION:r=function(t,e){var r=t.geometries.map((function(t){return G(t,e)}));return new d(r)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return m(r,!1,e)}function M(t,e){var r,i=(t=m(t,!0,e)).getType();switch(i){case a.a.POINT:r=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case a.a.LINE_STRING:r=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case a.a.POLYGON:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(r)}}(t,e);break;case a.a.MULTI_POINT:r=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case a.a.MULTI_LINE_STRING:r=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case a.a.MULTI_POLYGON:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(r)}}(t,e);break;case a.a.GEOMETRY_COLLECTION:r=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){var r=Object(g.a)({},e);return delete r.featureProjection,M(t,r)}))}}(t,e);break;case a.a.CIRCLE:r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+i)}return r}e.a=I},962:function(t,e,r){"use strict";var i,n=r(931),o=r(633),s=r(422),a=r(467),c=r(408),u=r(959),h=r(512),l=r(876),d=r(725),f=r(735),p=r(647),g=r(736),_=r(477),y=r(474),m=r(596),v=r(528),b=r(513),O=r(589),j=r(662),C=(r(363),r(838)),w=r(383),x=r(495),F=r(613),P=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),E="Point",S="LineString",T="Polygon",I="Circle",G="drawstart",M="drawend",L="drawabort",R=function(t){function e(e,r){var i=t.call(this,e)||this;return i.feature=r,i}return P(e,t),e}(o.a),k=function(t){function e(e){var r=this,i=e;i.stopDown||(i.stopDown=O.a),(r=t.call(this,i)||this).shouldHandle_=!1,r.downPx_=null,r.downTimeout_,r.lastDragTime_,r.freehand_=!1,r.source_=e.source?e.source:null,r.features_=e.features?e.features:null,r.snapTolerance_=e.snapTolerance?e.snapTolerance:12,r.type_=e.type,r.mode_=function(t){var e;t===c.a.POINT||t===c.a.MULTI_POINT?e=E:t===c.a.LINE_STRING||t===c.a.MULTI_LINE_STRING?e=S:t===c.a.POLYGON||t===c.a.MULTI_POLYGON?e=T:t===c.a.CIRCLE&&(e=I);return e}(r.type_),r.stopClick_=!!e.stopClick,r.minPoints_=e.minPoints?e.minPoints:r.mode_===T?3:2,r.maxPoints_=e.maxPoints?e.maxPoints:1/0,r.finishCondition_=e.finishCondition?e.finishCondition:O.b;var o,s=e.geometryFunction;if(!s)if(r.type_===c.a.CIRCLE)s=function(t,e,r){var i=e||new n.a([NaN,NaN]),o=Object(w.h)(t[0],r),s=Object(F.i)(o,Object(w.h)(t[1],r));i.setCenterAndRadius(o,Math.sqrt(s));var a=Object(w.n)();return a&&i.transform(r,a),i};else{var a,l=r.mode_;l===E?a=_.a:l===S?a=h.a:l===T&&(a=m.a),s=function(t,e,r){var i=e;return i?l===T?t[0].length?i.setCoordinates([t[0].concat([t[0][0]])]):i.setCoordinates([]):i.setCoordinates(t):i=new a(t),i}}return r.geometryFunction_=s,r.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,r.finishCoordinate_=null,r.sketchFeature_=null,r.sketchPoint_=null,r.sketchCoords_=null,r.sketchLine_=null,r.sketchLineCoords_=null,r.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,r.overlay_=new v.a({source:new b.a({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(o=Object(C.b)(),function(t,e){return o[t.getGeometry().getType()]}),updateWhileInteracting:!0}),r.geometryName_=e.geometryName,r.condition_=e.condition?e.condition:j.h,r.freehandCondition_,e.freehand?r.freehandCondition_=j.d:r.freehandCondition_=e.freehandCondition?e.freehandCondition:j.j,r.addEventListener(Object(x.b)(u.a.ACTIVE),r.updateState_),r}return P(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===s.a.CONTEXTMENU&&e.preventDefault(),this.freehand_=this.mode_!==E&&this.freehandCondition_(e);var r=e.type===d.a.POINTERMOVE,i=!0;!this.freehand_&&this.lastDragTime_&&e.type===d.a.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,r=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===d.a.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===d.a.POINTERDOWN?i=!1:r?(i=e.type===d.a.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.preventDefault()):("mouse"==e.originalEvent.pointerType||e.type===d.a.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===d.a.DBLCLICK&&(i=!1),t.prototype.handleEvent.call(this,e)&&i},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new l.a(d.a.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},e.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var r=this.mode_===I;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||r?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate):(this.startDrawing_(t),this.mode_===E&&this.finishDrawing()),e=!1):this.freehand_&&this.abortDrawing(),!e&&this.stopClick_&&t.stopPropagation(),e},e.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,r=t.pixel,i=e[0]-r[0],n=e[1]-r[1],o=i*i+n*n;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t)},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var r=!1,i=[this.finishCoordinate_];if(this.mode_===S)r=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===T){var n=this.sketchCoords_;r=n[0].length>this.minPoints_,i=[n[0][0],n[0][n[0].length-2]]}if(r)for(var o=t.map,s=0,a=i.length;s<a;s++){var c=i[s],u=o.getPixelFromCoordinate(c),h=t.pixel,l=h[0]-u[0],d=h[1]-u[1],f=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(l*l+d*d)<=f){this.finishCoordinate_=c;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new a.a(new _.a(e)),this.updateSketchFeatures_())},e.prototype.startDrawing_=function(t){var e=t.coordinate,r=t.map.getView().getProjection();this.finishCoordinate_=e,this.mode_===E?this.sketchCoords_=e.slice():this.mode_===T?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new a.a(new h.a(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_,void 0,r);this.sketchFeature_=new a.a,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_(),this.dispatchEvent(new R(G,this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,r,i,n=t.coordinate,o=this.sketchFeature_.getGeometry(),s=t.map.getView().getProjection();(this.mode_===E?r=this.sketchCoords_:this.mode_===T?(r=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(n=this.finishCoordinate_.slice())):r=(e=this.sketchCoords_)[e.length-1],r[0]=n[0],r[1]=n[1],this.geometryFunction_(this.sketchCoords_,o,s),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(n);if(o.getType()==c.a.POLYGON&&this.mode_!==T){this.sketchLine_||(this.sketchLine_=new a.a);var u=o.getLinearRing(0);(i=this.sketchLine_.getGeometry())?(i.setFlatCoordinates(u.getLayout(),u.getFlatCoordinates()),i.changed()):(i=new h.a(u.getFlatCoordinates(),u.getLayout()),this.sketchLine_.setGeometry(i))}else this.sketchLineCoords_&&(i=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,r,i=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();this.mode_===S?(this.finishCoordinate_=t.slice(),(r=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?r.pop():e=!0),r.push(t.slice()),this.geometryFunction_(r,i,n)):this.mode_===T&&((r=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?r.pop():e=!0),r.push(t.slice()),e&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,i,n)),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry(),r=this.getMap().getView().getProjection();this.mode_===S?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e,r),t.length>=2&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===T&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,r)),0===t.length&&this.abortDrawing(),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,r=t.getGeometry(),i=this.getMap().getView().getProjection();this.mode_===S?(e.pop(),this.geometryFunction_(e,r,i)):this.mode_===T&&(e[0].pop(),this.geometryFunction_(e,r,i),e=r.getCoordinates()),this.type_===c.a.MULTI_POINT?t.setGeometry(new p.a([e])):this.type_===c.a.MULTI_LINE_STRING?t.setGeometry(new f.a([e])):this.type_===c.a.MULTI_POLYGON&&t.setGeometry(new g.a([e])),this.dispatchEvent(new R(M,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),t},e.prototype.abortDrawing=function(){var t=this.abortDrawing_();t&&this.dispatchEvent(new R(L,t))},e.prototype.appendCoordinates=function(t){var e=this.mode_,r=[];e===S?r=this.sketchCoords_:e===T&&(r=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]);for(var i=r.pop(),n=0;n<t.length;n++)this.addToDrawing_(t[n]);this.addToDrawing_(i)},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var r=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=r.slice(),this.sketchCoords_.push(r.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new R(G,this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing(),this.overlay_.setMap(e?t:null)},e}(y.b);e.a=k},963:function(t,e,r){"use strict";var i,n=r(738),o=r(422),s=r(408),a=r(474),c=r(837),u=r(831),h=r(589),l=r(363),d=r(613),f=r(596),p=r(383),g=r(431),_=r(472),y=r(476),m=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function v(t){return t.feature?t.feature:t.element?t.element:void 0}var b=[],O=function(t){function e(e){var r=this,i=e||{},n=i;return n.handleDownEvent||(n.handleDownEvent=h.b),n.stopDown||(n.stopDown=h.a),(r=t.call(this,n)||this).source_=i.source?i.source:null,r.vertex_=void 0===i.vertex||i.vertex,r.edge_=void 0===i.edge||i.edge,r.features_=i.features?i.features:null,r.featuresListenerKeys_=[],r.featureChangeListenerKeys_={},r.indexedFeaturesExtents_={},r.pendingFeatures_={},r.pixelTolerance_=void 0!==i.pixelTolerance?i.pixelTolerance:10,r.rBush_=new c.a,r.SEGMENT_WRITERS_={Point:r.writePointGeometry_.bind(r),LineString:r.writeLineStringGeometry_.bind(r),LinearRing:r.writeLineStringGeometry_.bind(r),Polygon:r.writePolygonGeometry_.bind(r),MultiPoint:r.writeMultiPointGeometry_.bind(r),MultiLineString:r.writeMultiLineStringGeometry_.bind(r),MultiPolygon:r.writeMultiPolygonGeometry_.bind(r),GeometryCollection:r.writeGeometryCollectionGeometry_.bind(r),Circle:r.writeCircleGeometry_.bind(r)},r}return m(e,t),e.prototype.addFeature=function(t,e){var r=void 0===e||e,i=Object(g.c)(t),n=t.getGeometry();if(n){var s=this.SEGMENT_WRITERS_[n.getType()];s&&(this.indexedFeaturesExtents_[i]=n.getExtent(Object(l.j)()),s(t,n))}r&&(this.featureChangeListenerKeys_[i]=Object(y.a)(t,o.a.CHANGE,this.handleFeatureChange_,this))},e.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},e.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},e.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},e.prototype.handleEvent=function(e){var r=this.snapTo(e.pixel,e.coordinate,e.map);return r.snapped&&(e.coordinate=r.vertex.slice(0,2),e.pixel=r.vertexPixel),t.prototype.handleEvent.call(this,e)},e.prototype.handleFeatureAdd_=function(t){var e=v(t);this.addFeature(e)},e.prototype.handleFeatureRemove_=function(t){var e=v(t);this.removeFeature(e)},e.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var r=Object(g.c)(e);r in this.pendingFeatures_||(this.pendingFeatures_[r]=e)}else this.updateFeature_(e)},e.prototype.handleUpEvent=function(t){var e=Object(_.c)(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},e.prototype.removeFeature=function(t,e){var r=void 0===e||e,i=Object(g.c)(t),n=this.indexedFeaturesExtents_[i];if(n){var o=this.rBush_,s=[];o.forEachInExtent(n,(function(e){t===e.feature&&s.push(e)}));for(var a=s.length-1;a>=0;--a)o.remove(s[a])}r&&(Object(y.c)(this.featureChangeListenerKeys_[i]),delete this.featureChangeListenerKeys_[i])},e.prototype.setMap=function(e){var r=this.getMap(),i=this.featuresListenerKeys_,o=this.getFeatures_();r&&(i.forEach(y.c),i.length=0,o.forEach(this.forEachFeatureRemove_.bind(this))),t.prototype.setMap.call(this,e),e&&(this.features_?i.push(Object(y.a)(this.features_,n.a.ADD,this.handleFeatureAdd_,this),Object(y.a)(this.features_,n.a.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(Object(y.a)(this.source_,u.a.ADDFEATURE,this.handleFeatureAdd_,this),Object(y.a)(this.source_,u.a.REMOVEFEATURE,this.handleFeatureRemove_,this)),o.forEach(this.forEachFeatureAdd_.bind(this)))},e.prototype.snapTo=function(t,e,r){var i=r.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),n=r.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_]),o=Object(l.b)([i,n]),a=this.rBush_.getInExtent(o);this.vertex_&&!this.edge_&&(a=a.filter((function(t){return t.feature.getGeometry().getType()!==s.a.CIRCLE})));var c=!1,u=null,h=null;if(0===a.length)return{snapped:c,vertex:u,vertexPixel:h};for(var f,g=r.getView().getProjection(),_=Object(p.h)(e,g),y=1/0,m=0;m<a.length;++m){var v=a[m];b[0]=Object(p.h)(v.segment[0],g),b[1]=Object(p.h)(v.segment[1],g);var O=Object(d.j)(_,b);O<y&&(f=v,y=O)}var j=f.segment;if(this.vertex_&&!this.edge_){var C=r.getPixelFromCoordinate(j[0]),w=r.getPixelFromCoordinate(j[1]),x=Object(d.i)(t,C),F=Object(d.i)(t,w);Math.sqrt(Math.min(x,F))<=this.pixelTolerance_&&(c=!0,u=x>F?j[1]:j[0],h=r.getPixelFromCoordinate(u))}else if(this.edge_){var P=f.feature.getGeometry().getType()===s.a.CIRCLE;if(P){var E=f.feature.getGeometry(),S=Object(p.n)();S&&(E=E.clone().transform(S,g)),u=Object(p.p)(Object(d.b)(_,E),g)}else b[0]=Object(p.h)(j[0],g),b[1]=Object(p.h)(j[1],g),u=Object(p.p)(Object(d.c)(_,b),g);if(h=r.getPixelFromCoordinate(u),Object(d.d)(t,h)<=this.pixelTolerance_&&(c=!0,this.vertex_&&!P)){C=r.getPixelFromCoordinate(j[0]),w=r.getPixelFromCoordinate(j[1]),x=Object(d.i)(h,C),F=Object(d.i)(h,w);Math.sqrt(Math.min(x,F))<=this.pixelTolerance_&&(u=x>F?j[1]:j[0],h=r.getPixelFromCoordinate(u))}}return c&&(h=[Math.round(h[0]),Math.round(h[1])]),{snapped:c,vertex:u,vertexPixel:h}},e.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},e.prototype.writeCircleGeometry_=function(t,e){var r=this.getMap().getView().getProjection(),i=e,n=Object(p.n)();n&&(i=i.clone().transform(n,r));var o=Object(f.b)(i);n&&o.transform(r,n);for(var s=o.getCoordinates()[0],a=0,c=s.length-1;a<c;++a){var u=s.slice(a,a+2),h={feature:t,segment:u};this.rBush_.insert(Object(l.b)(u),h)}},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var r=e.getGeometriesArray(),i=0;i<r.length;++i){var n=this.SEGMENT_WRITERS_[r[i].getType()];n&&n(t,r[i])}},e.prototype.writeLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length-1;i<n;++i){var o=r.slice(i,i+2),s={feature:t,segment:o};this.rBush_.insert(Object(l.b)(o),s)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i)for(var o=r[i],s=0,a=o.length-1;s<a;++s){var c=o.slice(s,s+2),u={feature:t,segment:c};this.rBush_.insert(Object(l.b)(c),u)}},e.prototype.writeMultiPointGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i){var o=r[i],s={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i)for(var o=r[i],s=0,a=o.length;s<a;++s)for(var c=o[s],u=0,h=c.length-1;u<h;++u){var d=c.slice(u,u+2),f={feature:t,segment:d};this.rBush_.insert(Object(l.b)(d),f)}},e.prototype.writePointGeometry_=function(t,e){var r=e.getCoordinates(),i={feature:t,segment:[r,r]};this.rBush_.insert(e.getExtent(),i)},e.prototype.writePolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i)for(var o=r[i],s=0,a=o.length-1;s<a;++s){var c=o.slice(s,s+2),u={feature:t,segment:c};this.rBush_.insert(Object(l.b)(c),u)}},e}(a.b);e.a=O},964:function(t,e,r){"use strict";var i,n=r(754),o=r(738),s=r(633),a=r(422),c=r(467),u=r(408),h=r(725),l=r(477),d=r(474),f=r(837),p=r(831),g=r(528),_=r(513),y=r(662),m=r(363),v=r(613),b=r(838),O=r(407),j=r(596),C=r(383),w=r(431),x=(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),F=[0,0,0,0],P=[],E="modifystart",S="modifyend",T=function(t){function e(e,r,i){var n=t.call(this,e)||this;return n.features=r,n.mapBrowserEvent=i,n}return x(e,t),e}(s.a),I=function(t){function e(e){var r,i,s=t.call(this,e)||this;if(s.boundHandleFeatureChange_=s.handleFeatureChange_.bind(s),s.condition_=e.condition?e.condition:y.i,s.defaultDeleteCondition_=function(t){return Object(y.b)(t)&&Object(y.k)(t)},s.deleteCondition_=e.deleteCondition?e.deleteCondition:s.defaultDeleteCondition_,s.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:y.d,s.vertexFeature_=null,s.vertexSegments_=null,s.lastPixel_=[0,0],s.ignoreNextSingleClick_=!1,s.modified_=!1,s.rBush_=new f.a,s.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,s.snappedToVertex_=!1,s.changingFeature_=!1,s.dragSegments_=[],s.overlay_=new g.a({source:new _.a({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:(r=Object(b.b)(),function(t,e){return r[u.a.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),s.SEGMENT_WRITERS_={Point:s.writePointGeometry_.bind(s),LineString:s.writeLineStringGeometry_.bind(s),LinearRing:s.writeLineStringGeometry_.bind(s),Polygon:s.writePolygonGeometry_.bind(s),MultiPoint:s.writeMultiPointGeometry_.bind(s),MultiLineString:s.writeMultiLineStringGeometry_.bind(s),MultiPolygon:s.writeMultiPolygonGeometry_.bind(s),Circle:s.writeCircleGeometry_.bind(s),GeometryCollection:s.writeGeometryCollectionGeometry_.bind(s)},s.source_=null,e.source?(s.source_=e.source,i=new n.a(s.source_.getFeatures()),s.source_.addEventListener(p.a.ADDFEATURE,s.handleSourceAdd_.bind(s)),s.source_.addEventListener(p.a.REMOVEFEATURE,s.handleSourceRemove_.bind(s))):i=e.features,!i)throw new Error("The modify interaction requires features or a source");return s.features_=i,s.features_.forEach(s.addFeature_.bind(s)),s.features_.addEventListener(o.a.ADD,s.handleFeatureAdd_.bind(s)),s.features_.addEventListener(o.a.REMOVE,s.handleFeatureRemove_.bind(s)),s.lastPointerEvent_=null,s}return x(e,t),e.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var r=this.SEGMENT_WRITERS_[e.getType()];r&&r(t,e)}var i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),t.addEventListener(a.a.CHANGE,this.boundHandleFeatureChange_)},e.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new T(E,this.features_,t)))},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(a.a.CHANGE,this.boundHandleFeatureChange_)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,r=[];e.forEach((function(e){t===e.feature&&r.push(e)}));for(var i=r.length-1;i>=0;--i){for(var n=r[i],o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===n&&this.dragSegments_.splice(o,1);e.remove(n)}},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},e.prototype.writePointGeometry_=function(t,e){var r=e.getCoordinates(),i={feature:t,geometry:e,segment:[r,r]};this.rBush_.insert(e.getExtent(),i)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i){var o=r[i],s={feature:t,geometry:e,depth:[i],index:i,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length-1;i<n;++i){var o=r.slice(i,i+2),s={feature:t,geometry:e,index:i,segment:o};this.rBush_.insert(Object(m.b)(o),s)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i)for(var o=r[i],s=0,a=o.length-1;s<a;++s){var c=o.slice(s,s+2),u={feature:t,geometry:e,depth:[i],index:s,segment:c};this.rBush_.insert(Object(m.b)(c),u)}},e.prototype.writePolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i)for(var o=r[i],s=0,a=o.length-1;s<a;++s){var c=o.slice(s,s+2),u={feature:t,geometry:e,depth:[i],index:s,segment:c};this.rBush_.insert(Object(m.b)(c),u)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var r=e.getCoordinates(),i=0,n=r.length;i<n;++i)for(var o=r[i],s=0,a=o.length;s<a;++s)for(var c=o[s],u=0,h=c.length-1;u<h;++u){var l=c.slice(u,u+2),d={feature:t,geometry:e,depth:[s,i],index:u,segment:l};this.rBush_.insert(Object(m.b)(l),d)}},e.prototype.writeCircleGeometry_=function(t,e){var r=e.getCenter(),i={feature:t,geometry:e,index:0,segment:[r,r]},n={feature:t,geometry:e,index:1,segment:[r,r]},o=[i,n];i.featureSegments=o,n.featureSegments=o,this.rBush_.insert(Object(m.m)(r),i);var s=e,a=Object(C.n)();if(a&&this.getMap()){var c=this.getMap().getView().getProjection();s=s.clone().transform(a,c),s=Object(j.b)(s).transform(c,a)}this.rBush_.insert(s.getExtent(),n)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var r=e.getGeometriesArray(),i=0;i<r.length;++i){var n=r[i];(0,this.SEGMENT_WRITERS_[n.getType()])(t,n)}},e.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new c.a(new l.a(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e));return e},e.prototype.handleEvent=function(e){return!e.originalEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=h.a.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(r=!(e.type!=h.a.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==h.a.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!r);var r},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,r=0,i=this.dragSegments_.length;r<i;++r){for(var n=this.dragSegments_[r],o=n[0],s=o.depth,a=o.geometry,c=void 0,h=o.segment,l=n[1];e.length<a.getStride();)e.push(h[l][e.length]);switch(a.getType()){case u.a.POINT:c=e,h[0]=e,h[1]=e;break;case u.a.MULTI_POINT:(c=a.getCoordinates())[o.index]=e,h[0]=e,h[1]=e;break;case u.a.LINE_STRING:(c=a.getCoordinates())[o.index+l]=e,h[l]=e;break;case u.a.MULTI_LINE_STRING:case u.a.POLYGON:(c=a.getCoordinates())[s[0]][o.index+l]=e,h[l]=e;break;case u.a.MULTI_POLYGON:(c=a.getCoordinates())[s[1]][s[0]][o.index+l]=e,h[l]=e;break;case u.a.CIRCLE:if(h[0]=e,h[1]=e,0===o.index)this.changingFeature_=!0,a.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;var d=t.map.getView().getProjection(),f=Object(v.d)(Object(C.h)(a.getCenter(),d),Object(C.h)(e,d)),p=Object(C.n)();if(p){var g=a.clone().transform(p,d);g.setRadius(f),f=g.transform(d,p).getRadius()}a.setRadius(f),this.changingFeature_=!1}}c&&this.setGeometryCoordinates_(a,c)}this.createOrUpdateVertexFeature_(e)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;var e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.modified_=!1;var r=this.vertexFeature_;if(r){var i=t.map.getView().getProjection(),n=[],o=r.getGeometry().getCoordinates(),s=Object(m.b)([o]),a=this.rBush_.getInExtent(s),c={};a.sort(G);for(var h=0,l=a.length;h<l;++h){var d=a[h],f=d.segment,p=Object(w.c)(d.geometry),g=d.depth;if(g&&(p+="-"+g.join("-")),c[p]||(c[p]=new Array(2)),d.geometry.getType()!==u.a.CIRCLE||1!==d.index)if(!Object(v.e)(f[0],o)||c[p][0])if(!Object(v.e)(f[1],o)||c[p][1])Object(w.c)(f)in this.vertexSegments_&&!c[p][0]&&!c[p][1]&&this.insertVertexCondition_(t)&&n.push([d,o]);else{if((d.geometry.getType()===u.a.LINE_STRING||d.geometry.getType()===u.a.MULTI_LINE_STRING)&&c[p][0]&&0===c[p][0].index)continue;this.dragSegments_.push([d,1]),c[p][1]=d}else this.dragSegments_.push([d,0]),c[p][0]=d;else{var _=L(e,d,i);Object(v.e)(_,o)&&!c[p][0]&&(this.dragSegments_.push([d,0]),c[p][0]=d)}}n.length&&this.willModifyFeatures_(t);for(var y=n.length-1;y>=0;--y)this.insertVertex_.apply(this,n[y])}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var r=this.dragSegments_[e][0],i=r.geometry;if(i.getType()===u.a.CIRCLE){var n=i.getCenter(),o=r.featureSegments[0],s=r.featureSegments[1];o.segment[0]=n,o.segment[1]=n,s.segment[0]=n,s.segment[1]=n,this.rBush_.update(Object(m.m)(n),o);var a=i,c=Object(C.n)();if(c){var h=t.map.getView().getProjection();a=a.clone().transform(c,h),a=Object(j.b)(a).transform(h,c)}this.rBush_.update(a.getExtent(),s)}else this.rBush_.update(Object(m.b)(r.segment),r)}return this.modified_&&(this.dispatchEvent(new T(S,this.features_,t)),this.modified_=!1),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)},e.prototype.handlePointerAtPixel_=function(t,e,r){var i=r||e.getCoordinateFromPixel(t),n=e.getView().getProjection(),o=Object(C.i)(Object(m.m)(i,F),n),s=e.getView().getResolution()*this.pixelTolerance_,a=Object(C.q)(Object(m.c)(o,s,F),n),c=this.rBush_.getInExtent(a);if(c.length>0){c.sort((function(t,e){return M(i,t,n)-M(i,e,n)}));var h=c[0],l=h.segment,d=L(i,h,n),f=e.getPixelFromCoordinate(d),p=Object(v.d)(t,f);if(p<=this.pixelTolerance_){var g={};if(h.geometry.getType()===u.a.CIRCLE&&1===h.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d);else{var _=e.getPixelFromCoordinate(l[0]),y=e.getPixelFromCoordinate(l[1]),b=Object(v.i)(f,_),O=Object(v.i)(f,y);p=Math.sqrt(Math.min(b,O)),this.snappedToVertex_=p<=this.pixelTolerance_,this.snappedToVertex_&&(d=b>O?l[1]:l[0]),this.createOrUpdateVertexFeature_(d);for(var j=1,x=c.length;j<x;++j){var P=c[j].segment;if(!(Object(v.e)(l[0],P[0])&&Object(v.e)(l[1],P[1])||Object(v.e)(l[0],P[1])&&Object(v.e)(l[1],P[0])))break;g[Object(w.c)(P)]=!0}}return g[Object(w.c)(l)]=!0,void(this.vertexSegments_=g)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var r,i=t.segment,n=t.feature,o=t.geometry,s=t.depth,a=t.index;e.length<o.getStride();)e.push(0);switch(o.getType()){case u.a.MULTI_LINE_STRING:case u.a.POLYGON:(r=o.getCoordinates())[s[0]].splice(a+1,0,e);break;case u.a.MULTI_POLYGON:(r=o.getCoordinates())[s[1]][s[0]].splice(a+1,0,e);break;case u.a.LINE_STRING:(r=o.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(o,r);var c=this.rBush_;c.remove(t),this.updateSegmentIndices_(o,a,s,1);var h={segment:[i[0],e],feature:n,geometry:o,depth:s,index:a};c.insert(Object(m.b)(h.segment),h),this.dragSegments_.push([h,1]);var l={segment:[e,i[1]],feature:n,geometry:o,depth:s,index:a+1};c.insert(Object(m.b)(l.segment),l),this.dragSegments_.push([l,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=h.a.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t);var e=this.removeVertex_();return this.dispatchEvent(new T(S,this.features_,t)),this.modified_=!1,e}return!1},e.prototype.removeVertex_=function(){var t,e,r,i,n,o,s,a,c,h,l,d=this.dragSegments_,f={},p=!1;for(n=d.length-1;n>=0;--n)h=(r=d[n])[0],l=Object(w.c)(h.feature),h.depth&&(l+="-"+h.depth.join("-")),l in f||(f[l]={}),0===r[1]?(f[l].right=h,f[l].index=h.index):1==r[1]&&(f[l].left=h,f[l].index=h.index+1);for(l in f){switch(c=f[l].right,s=f[l].left,(a=(o=f[l].index)-1)<0&&(a=0),t=e=(i=(h=void 0!==s?s:c).geometry).getCoordinates(),p=!1,i.getType()){case u.a.MULTI_LINE_STRING:e[h.depth[0]].length>2&&(e[h.depth[0]].splice(o,1),p=!0);break;case u.a.LINE_STRING:e.length>2&&(e.splice(o,1),p=!0);break;case u.a.MULTI_POLYGON:t=t[h.depth[1]];case u.a.POLYGON:(t=t[h.depth[0]]).length>4&&(o==t.length-1&&(o=0),t.splice(o,1),p=!0,0===o&&(t.pop(),t.push(t[0]),a=t.length-1))}if(p){this.setGeometryCoordinates_(i,e);var g=[];if(void 0!==s&&(this.rBush_.remove(s),g.push(s.segment[0])),void 0!==c&&(this.rBush_.remove(c),g.push(c.segment[1])),void 0!==s&&void 0!==c){var _={depth:h.depth,feature:h.feature,geometry:h.geometry,index:a,segment:g};this.rBush_.insert(Object(m.b)(_.segment),_)}this.updateSegmentIndices_(i,o,h.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return p},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,r,i){this.rBush_.forEachInExtent(t.getExtent(),(function(n){n.geometry===t&&(void 0===r||void 0===n.depth||Object(O.b)(n.depth,r))&&n.index>e&&(n.index+=i)}))},e}(d.b);function G(t,e){return t.index-e.index}function M(t,e,r){var i=e.geometry;if(i.getType()===u.a.CIRCLE){var n=i;if(1===e.index){var o=Object(C.n)();o&&(n=n.clone().transform(o,r));var s=Object(v.i)(n.getCenter(),Object(C.h)(t,r)),a=Math.sqrt(s)-n.getRadius();return a*a}}var c=Object(C.h)(t,r);return P[0]=Object(C.h)(e.segment[0],r),P[1]=Object(C.h)(e.segment[1],r),Object(v.j)(c,P)}function L(t,e,r){var i=e.geometry;if(i.getType()===u.a.CIRCLE&&1===e.index){var n=i,o=Object(C.n)();return o&&(n=n.clone().transform(o,r)),Object(C.p)(n.getClosestPoint(Object(C.h)(t,r)),r)}var s=Object(C.h)(t,r);return P[0]=Object(C.h)(e.segment[0],r),P[1]=Object(C.h)(e.segment[1],r),Object(C.p)(Object(v.c)(s,P),r)}e.a=I}}]);