(window.webpackJsonp=window.webpackJsonp||[]).push([[557,5],{1011:function(t,e,i){"use strict";var r=i(53),n=(i(198),i(124),i(85),i(52)),o=i(528),s=i(513),a=i(962),h=i(963),c=i(964),u=i(799),l=i(401),d={fill:"rgba(255, 255, 255, 0.5)",stroke:{color:"#409eff",width:2},circle:{radius:6,fill:"#409eff",stroke:{width:1,color:"#fff"}}},p={name:"spMapDraw",inject:["myMap"],render:function(){return this.$slots.default},props:{type:{type:String,default:"LineString",validator:function(t){return["Point","LineString","Polygon","Circle"].includes(t)}},brush:{type:[Object,Function]},effect:{type:[Object,Function],default:function(){return d}},manual:Boolean,options:Object},watch:{type:function(){this.manual||(this.finish(),this.draw(),this.modify())}},methods:{getStyle:function(t){return t?"function"==typeof t?t():Object(l.a)(t):null},init:function(t){if(!this.layer){var e=new s.a,i=this.getStyle(this.effect);this.layer=new o.a({source:e,style:i}),t.addLayer(this.layer),this.manual||(this.draw(),this.modify()),this.$emit("ready",this)}},draw:function(t){var e=this;if(this.layer){var i=this.layer.getSource(),r=this.getStyle(this.brush),o=this.type,s=this.myMap.map,c=new a.a(Object(n.a)(Object(n.a)({},this.options),{},{type:o,source:i,style:r}));this.drawStartHandler=function(t){e.$emit("drawstart",t)},this.drawEndHandler=function(i){t&&t(i),e.$emit("drawend",i)},c.on("drawstart",this.drawStartHandler),c.on("drawend",this.drawEndHandler),this.drawInstance=c,this.snapInstance=new h.a({source:i}),s.addInteraction(c),s.addInteraction(this.snapInstance)}},modify:function(t){var e=this;if(this.layer){var i=this.myMap.map,r=this.layer.getSource(),o=this.getStyle(this.brush),s=new c.a(Object(n.a)(Object(n.a)({},this.options),{},{source:r,style:o}));this.modifyStartHandler=function(t){e.$emit("modifystart",t)},this.modifyEndHandler=function(i){t&&t(i),e.$emit("modifyend",i)},s.on("modifystart",this.modifyStartHandler),s.on("modifyend",this.modifyEndHandler),this.modifyInstance=s,i.addInteraction(this.modifyInstance)}},finish:function(){var t=this.myMap.map;if(t){var e=this.drawInstance,i=this.modifyInstance;e&&(e.un("drawstart",this.drawStartHandler),e.un("drawend",this.drawEndHandler),e.dispose(),t.removeInteraction(e),t.removeInteraction(this.snapInstance),this.drawInstance=null),i&&(i.un("modifystart",this.modifyStartHandler),i.un("modifyend",this.modifyEndHandler),i.dispose(),t.removeInteraction(i),this.modifyInstance=null)}},dispose:function(){this.finish(),this.myMap.map&&this.layer&&this.myMap.map.removeLayer(this.layer)},getFeatures:function(){return this.layer?this.layer.getSource().getFeatures():[]},clear:function(){this.layer&&this.layer.getSource().clear()},removeFeature:function(t){this.layer.getSource().removeFeature(t)},addFeature:function(t){var e=[].concat(t);this.layer.getSource().addFeatures(e)},toJSON:function(){var t=this.getFeatures();return(new u.a).writeFeatures(t)},fromJSON:function(t){var e=(new u.a).readFeatures(t);this.addFeature(e)},writeFeature:function(t){return(new u.a).writeFeature(t)},readFeature:function(t){return(new u.a).writeFeature(t)}},created:function(){this.myMap.mapReady(this.init)},beforeDestroy:function(){this.dispose()}};e.a=Object(r.a)(p)},1279:function(t,e,i){},1388:function(t,e,i){"use strict";var r=i(53),n=(i(124),i(85),i(432),i(932)),o=i(0),s=i(1011),a=i(650),h=i(960),c={fill:"rgba(64,158,255,0.2)",stroke:{color:"rgba(64,158,255,0.7)",width:2,lineDash:[10,10]},circle:{radius:5,stroke:{width:2,color:"#409eff"}}},u={name:"spMapMeasure",inject:["myMap"],components:{MapDraw:s.a},props:{type:{type:String,default:"line",validator:function(t){return["line","area"].includes(t)}},disabled:Boolean,theme:{type:String,default:"light",validator:function(t){return["light","dark"].includes(t)}},startTip:{type:String,default:"单击确定起点"},endTip:{type:String,default:"单击继续，双击结束"},brush:{type:[Object,Function],default:function(){return c}},effect:[Object,Function]},computed:{drawType:function(){return{line:"LineString",area:"Polygon"}[this.type]}},data:function(){return{helpTipPosition:null,helpTip:this.startTip,measureTip:null,measureTipPosition:null,measureTipOffset:[0,-15],changeListener:null,measures:[],value:0}},watch:{disabled:function(t){t?this.$refs.draw.finish():this.$refs.draw.draw()}},methods:{init:function(t){this.myMap.map.on("pointermove",this.handlePointerMove),this.disabled||t.draw()},formatLength:function(t){var e=this.value=Object(a.c)(t,{projection:this.myMap.projection});return e>100?Math.round(e/1e3*100)/100+" km":Math.round(100*e)/100+" m"},formatArea:function(t){var e=this.value=Object(a.a)(t,{projection:this.myMap.projection});return e>1e4?Math.round(e/1e6*100)/100+" km<sup>2</sup>":Math.round(100*e)/100+" m<sup>2</sup>"},handlePointerMove:function(t){this.helpTipPosition=t.coordinate},handleDrawStart:function(t){var e=this;this.value=0;var i,r=t.feature.getGeometry(),n=t.coordinate;this.changeListener=r.on("change",(function(t){var r=t.target;"line"===e.type?(i=e.formatLength(r),n=r.getLastCoordinate()):"area"===e.type&&(i=e.formatArea(r),n=r.getInteriorPoint().getCoordinates()),e.helpTip=e.endTip,e.$nextTick((function(){e.measureTipPosition=n,e.measureTip=i}))}))},handleDelete:function(t,e){this.$refs.draw.removeFeature(t.feature),this.measures.splice(e,1)},handleDrawEnd:function(t){var e=this,i=t.feature;this.changeListener&&Object(h.b)(this.changeListener),this.measures.push({feature:i,position:this.measureTipPosition,content:this.measureTip}),this.$nextTick((function(){e.helpTip=e.startTip,e.helpTipPosition=null})),setTimeout((function(){e.measureTipPosition=null}),0),this.$emit("end",this.value)},clear:function(){this.$refs.draw&&this.$refs.draw.clear()}},beforeDestroy:function(){this.$refs.draw&&this.$refs.draw.finish(),this.myMap.map&&this.myMap.map.un("pointermove",this.handlePointerMove)}};o.default.use(n.a);var l=u,d=i(18),p=Object(d.a)(l,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("MapDraw",{ref:"draw",attrs:{brush:t.brush,effect:t.effect,type:t.drawType,manual:""},on:{ready:t.init,drawstart:t.handleDrawStart,drawend:t.handleDrawEnd}}),t._v(" "),t._l(t.measures,(function(e,r){return i("sp-map-html",{key:r,staticClass:"sp-map-measure__tip",class:"is-"+t.theme,attrs:{positioning:"bottom-center",position:e.position,offset:[0,-7]}},[i("span",{domProps:{innerHTML:t._s(e.content)}}),t._v(" "),i("i",{staticClass:"sp-map-measure__delete el-icon-delete",on:{click:function(i){return t.handleDelete(e,r)}}})])})),t._v(" "),t.helpTipPosition&&!t.disabled?i("sp-map-html",{ref:"helpTooltip",staticClass:"sp-map-measure__help",class:"is-"+t.theme,attrs:{offset:[15,0],positioning:"center-left",position:t.helpTipPosition}},[t._v("\n    "+t._s(t.helpTip)+"\n  ")]):t._e(),t._v(" "),t.measureTipPosition?i("sp-map-html",{staticClass:"sp-map-measure__tip",class:"is-"+t.theme,attrs:{position:t.measureTipPosition,offset:[0,-15],positioning:"bottom-center"}},[i("span",{domProps:{innerHTML:t._s(t.measureTip)}})]):t._e()],2)}),[],!1,null,null,null).exports;i(1279),e.a=Object(r.a)(p)},2864:function(t,e,i){"use strict";i.r(e);var r=i(1388),n=i(418),o=i(0);o.default.use(n.a),o.default.use(r.a);var s={},a=i(18),h=Object(a.a)(s,(function(){var t=this.$createElement,e=this._self._c||t;return e("sp-map",[e("sp-map-measure",{attrs:{theme:"dark"}})],1)}),[],!1,null,null,null);e.default=h.exports},401:function(t,e,i){"use strict";i(54),i(124),i(365),i(199),i(55);var r=i(86),n=i(57),o=i(764),s=i(839),a=i(1185),h=i(1186),c=i(1866),u=i(1187),l=i(838),d={fill:o.a,text:s.a,stroke:a.a,circle:h.a,icon:c.a,regularShape:u.a,backgroundFill:o.a,backgroundStroke:a.a},p=[h.a,c.a,u.a];function f(t){return"object"===Object(n.a)(t)}function g(t,e,i){var r,n;if(null!=i)return t?["fill","backgroundFill"].includes(e)?(n=f(r=i)?r:{color:r},new o.a(n)):"text"===e?f(i)?m(i,t):i:m(i,t):i}function m(t,e){var i={};return Object.entries(t).forEach((function(t){var e=Object(r.a)(t,2),n=e[0],o=e[1],s=d[n];"font"===n&&(o="".concat(o," sans-serif")),i[p.includes(s)?"image":n]=g(s,n,o)})),new(e||l.c)(i)}e.a=m},418:function(t,e,i){"use strict";var r=i(53),n=(i(198),i(21),i(385),i(54),i(87),i(85),i(197),i(429),i(365),i(55),i(52)),o=i(86),s=i(600),a=i(555),h=i(533),c=i(534),u=i(474),l=i(528),d=i(513),p=i(460),f=i(360),g={name:"spMap",provide:function(){return{myMap:this}},props:{zoom:{type:Number,default:10},minZoom:{type:Number,default:1},maxZoom:{type:Number,default:20},center:{type:Array,default:function(){return[113.261999,23.130592]}},adapter:{type:[String,Object,Function],default:"Baidu"},projection:{type:String,default:"EPSG:4326"},width:{type:String,default:"100%"},height:{type:String,default:"400px"},dragPan:{type:Boolean,default:!0},mouseWheelZoom:{type:Boolean,default:!0},mapOptions:Object,viewOptions:Object,invert:Boolean,filter:Object},render:function(){var t=arguments[0];return t("div",{class:this.classes,style:this.styles},[this.$slots.default])},data:function(){return{cursor:null,viewWidth:0,viewHeight:0}},computed:{classes:function(){return{"sp-map":!0,"sp-map--invert":this.invert}},styles:function(){return{width:this.width,height:this.height,cursor:this.cursor?"pointer":""}},filterStyle:function(){return this.filter?Object.entries(this.filter).map((function(t){var e=Object(o.a)(t,2),i=e[0],r=e[1];return"hue-rotate"===i?"".concat(i,"(").concat(r,"deg)"):"".concat(i,"(").concat(r,")")})).join(" "):null}},watch:{dragPan:function(t){this.setActive(h.a,t)},mouseWheelZoom:function(t){this.setActive(c.a,t)},filterStyle:function(){this.setCanvasFilter()}},methods:{setActive:function(t,e){if(this.map){var i=this.map.getInteractions().getArray().find((function(e){return e instanceof t}));i&&i.setActive(e)}},init:function(){var t=this.$props,e=t.center,i=t.projection,r=t.zoom,o=t.minZoom,l=t.maxZoom,d=Object(p.a)(this.adapter);d.__MY_LAYER__=!0;var g=new a.a(Object(n.a)(Object(n.a)({},this.viewOptions||{}),{},{projection:i,center:e,zoom:r,minZoom:o,maxZoom:l}));this.map=new s.a(Object(n.a)(Object(n.a)({},this.mapOptions||{}),{},{layers:[].concat(d),view:g,target:this.$el,controls:[],interactions:[new h.a,new c.a,new u.b({handleEvent:this.handleEvent})]})),this.setActive(h.a,this.dragPan),this.setActive(c.a,this.mouseWheelZoom),this.bindMapEvents(),this.$emit("ready",this.map,this),Object(f.addResizeListener)(this.$el,this.setViewSize),this.setCanvasFilter()},dispose:function(){this.map&&(this.map.disposeInternal(),this.unbindMapEvents(),Object(f.removeResizeListener)(this.$el,this.setViewSize))},getFeatureAtPixel:function(t){return this.map?this.map.forEachFeatureAtPixel(t,(function(t){return t})):null},setCursor:function(t){var e=this.getFeatureVM(t);this.cursor=e&&(e.cursor||e.$listeners.click)},clickTrigger:function(t,e){if(t){var i=this.getFeatureVM(t);i&&i.$emit("click",e,t)}},getLayer:function(){return this.map?this.map.getLayers().getArray().find((function(t){return t.__MY_LAYER__})):null},getFeatureVM:function(t){if(t){var e=(t.get("features")||[])[0]||t;return e.__vm__||e.get("__vm__")}},enterAndLeaveTrigger:function(t,e){if(!this.featureAtPixel&&t){this.$emit("mouseenter",e,t);var i=this.getFeatureVM(t);i&&i.$emit("mouseenter",e,t)}if(this.featureAtPixel&&!t){this.$emit("mouseleave",e,this.featureAtPixel);var r=this.getFeatureVM(this.featureAtPixel);r&&r.$emit("mouseleave",e,this.featureAtPixel)}if(this.featureAtPixel&&t&&this.featureAtPixel!==t){this.$emit("mouseleave",e,this.featureAtPixel),this.$emit("mouseenter",e,t);var n=this.getFeatureVM(this.featureAtPixel);n&&n.$emit("mouseleave",e,this.featureAtPixel);var o=this.getFeatureVM(t);o&&o.$emit("mouseenter",e,t)}this.featureAtPixel=t},handleEvent:function(t){var e=t.type,i=this.getFeatureAtPixel(t.pixel);switch(e){case"pointermove":this.setCursor(i),this.enterAndLeaveTrigger(i,t);break;case"click":this.clickTrigger(i,t)}return!0},bindMapEvents:function(){var t=this;this.map&&Object.entries(this.$listeners).forEach((function(e){var i=Object(o.a)(e,2),r=i[0],n=i[1];return t.map.on(r,n)}))},unbindMapEvents:function(){var t=this;this.map&&Object.entries(this.$listeners).forEach((function(e){var i=Object(o.a)(e,2),r=i[0],n=i[1];return t.map.un(r,n)}))},resize:function(){this.map.updateSize()},moveTo:function(t){this.map&&this.map.getView().animate({center:t,duration:200})},zoomTo:function(t){this.map&&this.map.getView().animate({zoom:Number.parseInt(t),duration:200})},zoomIn:function(){if(this.map){var t=this.map.getView();this.zoomTo(t.getZoom()+1)}},zoomOut:function(){if(this.map){var t=this.map.getView();this.zoomTo(t.getZoom()-1)}},mapReady:function(t){this.map?t&&t(this.map,this):this.$once("ready",t)},createVectorLayer:function(){if(this.map&&!this.vectorLayer){var t=new d.a;return this.vectorLayer=new l.a({source:t,zIndex:1}),this.map.addLayer(this.vectorLayer),this.vectorLayer}},addFeature:function(t){if(this.map){this.vectorLayer||this.createVectorLayer();var e=this.vectorLayer.getSource(),i=[].concat(t);e.addFeatures(i)}},removeFeature:function(t){if(this.vectorLayer){var e=this.vectorLayer.getSource();[].concat(t).forEach((function(t){return e.removeFeature(t)}))}},getMetersPerUnit:function(){return this.map?this.map.getView().getProjection().getMetersPerUnit():0},setViewSize:function(){var t=this.$el.getBoundingClientRect();this.viewWidth=t.width||0,this.viewHeight=t.height||0,this.map&&this.map.updateSize(),this.$emit("viewSizeChange",t)},setCanvasFilter:function(){if(this.map){var t=this.map.getViewport();t&&(t.style.filter=this.filterStyle)}},clear:function(){this.map&&this.map.getLayers().getArray().filter((function(t){return!t.__MY_LAYER__})).forEach((function(t){t.getSource().clear()}))}},mounted:function(){this.init()},beforeDestroy:function(){this.dispose()}};i(597),i(468),e.a=Object(r.a)(g)},428:function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"d",(function(){return a})),i.d(e,"a",(function(){return h})),i.d(e,"b",(function(){return c}));i(54),i(87),i(32),i(482),i(33),i(88),i(430),i(58),i(503),i(402);var r=i(480),n=i.n(r),o=/^(http|https):\/\/[\w.:]*\//;function s(t,e,i){var r,n={};t=(t||location.search).replace(/^[^]*\?/,""),e=e||"&",i=i||"=";for(var o=new RegExp("(?:^|\\"+e+")([^\\"+i+"\\"+e+"]+)(?:\\"+i+"([^\\"+e+"]*))?","g");null!==(r=o.exec(t));)r[1]!==t&&(n[decodeURIComponent(r[1])]=decodeURIComponent(r[2]||""));return n}function a(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push([i,encodeURIComponent(t[i])].join("="));return e.join("&")}function h(t){var e=t.match(o);return e?e[0]:""}function c(t,e){var i=[],r=h(t),o=n()(t.replace(r,""),i).exec(e.split("?")[0].replace(r,"")),s={};return o&&o.length>0&&i.forEach((function(t,e){s[t.name]=o[e+1]})),s}},432:function(t,e,i){"use strict";var r=i(1),n=i(128),o=i(59),s=i(19),a=i(16),h=i(133),c=i(63),u=i(62),l=i(20),d=u("splice"),p=l("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,g=Math.min;r({target:"Array",proto:!0,forced:!d||!p},{splice:function(t,e){var i,r,u,l,d,p,m=a(this),y=s(m.length),_=n(t,y),v=arguments.length;if(0===v?i=r=0:1===v?(i=0,r=y-_):(i=v-2,r=g(f(o(e),0),y-_)),y+i-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(u=h(m,r),l=0;l<r;l++)(d=_+l)in m&&c(u,l,m[d]);if(u.length=r,i<r){for(l=_;l<y-r;l++)p=l+i,(d=l+r)in m?m[p]=m[d]:delete m[p];for(l=y;l>y-r+i;l--)delete m[l-1]}else if(i>r)for(l=y-r;l>_;l--)p=l+i-1,(d=l+r-1)in m?m[p]=m[d]:delete m[p];for(l=0;l<i;l++)m[l+_]=arguments[l+2];return m.length=y-r+i,u}})},460:function(t,e,i){"use strict";i.d(e,"a",(function(){return Q}));i(198),i(85);var r=i(52),n=i(57),o=i(462),s=i(591),a=i(598),h=i(457),c=i(602),u=i(548),l=i(404),d=i(590),p=(i(87),i(32),i(7),i(88),i(27)),f=i(60),g=i(129),m=i(130),y=i(132),_=i(131),v=i(481),b=i(535),O="METER",C="KILOMETER",j="DEGREE",w="INCH",P="FOOT",E="ISERVER";function T(t,e,i){var r=t*e*(1/.0254)*function(t){var e;if(t===O)e=1;else if(t===j)e=2*Math.PI*6378137/360;else if(t===C)e=.001;else if(t===w)e=1/.025399999918;else{if(t!==P)return e;e=.3048}return e}(i);return r=1/r}function x(t,e,i){var r=t*e*(1/.0254)*this.getMeterPerMapUnit(i);return r=1/r}var F=function(t){Object(y.a)(i,t);var e=Object(_.a)(i);function i(t){var r;if(Object(p.a)(this,i),void 0===(t=t||{}).url)return Object(g.a)(r);t.format=t.format?t.format:"png";var n=t.url+"/tileImage."+t.format+"?";t.serverType=t.serverType||E,r=e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,logo:t.logo,opaque:t.opaque,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:t.tileClass,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:function(e,r,n){o.tileGrid||(o.extent?(o.tileGrid=i.createTileGrid(t.extent),o.resolutions&&(o.tileGrid.resolutions=o.resolutions)):("EPSG:3857"===n.getCode()&&(o.tileGrid=i.createTileGrid([-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892]),o.extent=[-20037508.3427892,-20037508.3427892,20037508.3427892,20037508.3427892]),"EPSG:4326"===n.getCode()&&(o.tileGrid=i.createTileGrid([-180,-90,180,90]),o.extent=[-180,-90,180,90])));o.origin=o.tileGrid.getOrigin(0);var s=e[0],h=e[1],c=-e[2]-1,u=o.tileGrid.getResolution(s),l=n.getUnits();"degrees"===l&&(l=j);"m"===l&&(l=O);var d=T(u,96,l),p=Object(v.c)(o.tileGrid.getTileSize(s,o.tmpSize)),f=a.call(o)+encodeURI("&x="+h+"&y="+c+"&width="+p[0]+"&height="+p[1]+"&scale="+d);o.tileProxy&&(f=o.tileProxy+encodeURIComponent(f));o.cacheEnabled||(f+="&_t="+(new Date).getTime());return f},url:t.url,urls:t.urls,wrapX:void 0!==t.wrapX&&t.wrapX,cacheEnabled:t.cacheEnabled,layersID:t.layersID}),t.tileProxy&&(r.tileProxy=t.tileProxy),r.options=t,r._url=t.url,r.tileSetsIndex=-1,r.tempIndex=-1;var o=Object(m.a)(r);function s(){var e={};return e.redirect=void 0!==t.redirect&&t.redirect,e.transparent=void 0===t.transparent||t.transparent,e.cacheEnabled=!(!1===t.cacheEnabled),this.cacheEnabled=e.cacheEnabled,e._cache=e.cacheEnabled,this.origin&&(e.origin=JSON.stringify({x:this.origin[0],y:this.origin[1]})),t.prjCoordSys&&(e.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(e.layersID=t.layersID.toString()),t.overlapDisplayed?e.overlapDisplayed=!0:(e.overlapDisplayed=!1,t.overlapDisplayedOptions&&(e.overlapDisplayedOptions=this.overlapDisplayedOptions.toString())),t.cacheEnabled&&t.tileversion&&(e.tileversion=t.tileversion.toString()),e}function a(){return this._paramsChanged&&(this._layerUrl=h.call(this),this._paramsChanged=!1),this._layerUrl||h.call(this)}function h(){return this._layerUrl=n+encodeURI(c.call(this)),this._layerUrl}function c(){this.requestParams=this.requestParams||s.call(this);var t=[];for(var e in this.requestParams)t.push(e+"="+this.requestParams[e]);return t.join("&")}return r}return Object(f.a)(i,[{key:"setTileSetsInfo",value:function(t){this.tileSets=t,Array.isArray(this.tileSets)&&(this.tileSets=t[0]),this.tileSets&&(this.dispatchEvent({type:"tilesetsinfoloaded",value:{tileVersions:this.tileSets.tileVersions}}),this.changeTilesVersion())}},{key:"lastTilesVersion",value:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()}},{key:"nextTilesVersion",value:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()}},{key:"changeTilesVersion",value:function(){var t=this;if(null!=t.tileSets&&!(t.tempIndex===t.tileSetsIndex||this.tempIndex<0)){var e=t.tileSets.tileVersions;if(e&&t.tempIndex<e.length&&t.tempIndex>=0){var i=e[t.tempIndex].name;t.mergeTileVersionParam(i)&&(t.tileSetsIndex=t.tempIndex,t.dispatchEvent({type:"tileversionschanged",value:{tileVersion:e[t.tempIndex]}}))}}}},{key:"updateCurrentTileSetsIndex",value:function(t){this.tempIndex=t}},{key:"mergeTileVersionParam",value:function(t){return!!t&&(this.requestParams.tileversion=t,this._paramsChanged=!0,this.refresh(),!0)}}],[{key:"optionsFromMapJSON",value:function(t,e){var i={};i.url=t,i.crossOrigin="anonymous";var r=[e.bounds.left,e.bounds.bottom,e.bounds.right,e.bounds.top],n=function(){var t,i=r[2]-r[0],n=r[3]-r[1],o=i>=n?i:n;t=o===i?o/e.viewer.width:o/e.viewer.height;var s=[],a=O;e.coordUnit===j&&(a=j);if(e.visibleScalesEnabled&&e.visibleScales&&e.visibleScales.length>0)for(var h=0;h<e.visibleScales.length;h++)s.push(x(e.visibleScales[h],96,a));else for(var c=0;c<17;c++)s.push(t/Math.pow(2,c));return s.sort((function(t,e){return e-t}))}();return i.tileGrid=new l.a({extent:r,resolutions:n}),i}},{key:"createTileGrid",value:function(t,e,i,r,n){var o=Object(b.a)({extent:t,maxZoom:e,minZoom:i,tileSize:r});return new l.a({extent:t,minZoom:i,origin:n,resolutions:o.getResolutions(),tileSize:o.getTileSize()})}}]),i}(u.a),S=i(363),M=i(383),G=i(428),I=(i(33),i(58),i(599)),L=i.n(I),R=new M.b({code:"baidu",extent:[-20037726.37,-12474104.17,20037726.37,12474104.17],units:"m"});Object(M.d)(R),Object(M.c)("EPSG:4326",R,L.a.ll2bmerc,L.a.bmerc2ll),Object(M.c)("EPSG:3857",R,L.a.smerc2bmerc,L.a.bmerc2smerc);for(var k=new Array(19),N=0;N<19;++N)k[N]=Math.pow(2,18-N);var A=function(t){return new o.a({source:new h.a({projection:"baidu",maxZoom:18,tileUrlFunction:function(e){var i=e[1],r=-e[2]-1,n=e[0];i<0&&(i="M"+-i),r<0&&(r="M"+-r);var o=Math.ceil(5*Math.random());return t.url.replace(/{x}/g,i).replace(/{y}/g,r).replace(/{z}/g,n).replace(/{n}/g,o)},tileGrid:new l.a({resolutions:k,origin:[0,0]})})})},D="http://webrd03.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}&lang=zh_cn",V="http://online{n}.map.bdimg.com/tile/?qt=vtile&x={x}&y={y}&z={z}&styles=pl&scaler=1&udt=20190718",U="http://10.8.6.103/PGIS_S_TileMapServer/Maps/BJSL/EzMap?Service=getImage&Type=RGB&ZoomOffset=0",B="http://53.1.238.17/iserver/services/map-pgisvec/rest/maps/pgisvecv1",$="http://68.26.21.71/images/GetImage.do?method=showImageRedisBytable&jinyi_admin:MA_PGISSLDT&version=v1";function H(){for(var t=[],e=0;e<20;e++){var i=e<7?[64,64]:[107.5,28];t.push(i)}return t}function Y(){for(var t=[],e=0;e<20;e++){var i=2.0000081722216954/Math.pow(2,e);t.push(i)}return t}function z(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EPSG:4326",e=256,i=Object(M.j)(t),r=i.getExtent(),n=Object(S.E)(r)/e,o=[],s=[],a=0;a<=20;a++)o[a]=a,s[a]=n/Math.pow(2,a);return new d.b({origin:Object(S.C)(r),resolutions:s,matrixIds:o})}function X(t){var e=t.layers.map((function(t){return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vec_c";return new o.a({source:new h.a({url:"http://t{0-7}.tianditu.com/DataServer?T="+t+"&x={x}&y={y}&l={z}&tk=464554f64aa4f4e90e0321c17a57a331"})})}(t)}));return new s.a({layers:e})}function q(t){var e=z(),i=t.url;return new o.a({source:new c.a({url:i,tileGrid:e}),wrapX:!1})}function Z(t){var e=t.url,i=z();return new o.a({source:new c.a({url:"",crossOrigin:"Anonymous",tileGrid:i,tileLoadFunction:function(t,i){var r=Object(G.c)(i),n={Row:r.TileRow,Col:r.TileCol,Zoom:r.TileMatrix,V:"1.0.0"};t.getImage().src="".concat(e,"&").concat(Object(G.d)(n))}}),wrapX:!1})}function W(t){if("function"==typeof t.url){var e=t.url,i=z();return new o.a({source:new c.a({url:"",crossOrigin:"Anonymous",tileGrid:i,tileLoadFunction:function(t,i){var r=Object(G.c)(i);t.getImage().src=e(r)}}),wrapX:!1})}return Z(t)}function K(t){return new o.a({source:new F({url:t.url}),projection:t.projection||"EPSG:4326"})}function J(t){var e=t.url;return new o.a({projection:t.projection||"EPSG:4326",url:"".concat(e,"&l={z}&x={y}&y={x}"),tileGrid:new l.a({origin:t.origins||H(),resolutions:t.resolutions||Y()})})}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("function"==typeof t)return t({TileLayer:o.a,LayerGroup:s.a,OSM:a.a,XYZ:h.a,WMTS:c.a,TileImage:u.a,TileGrid:l.a,WMTSGrid:d.b,getWidth:S.E,getTopLeft:S.C,getProj:M.j});var i="object"===Object(n.a)(t)?Object(r.a)({},t):{type:t},p=i.type;switch(delete i.type,p){case"OSM":return new o.a(Object(r.a)(Object(r.a)({},e),{},{source:new a.a(i)}));case"XYZ":return new o.a(Object(r.a)(Object(r.a)({},e),{},{source:new h.a(i)}));case"Amap":return new o.a(Object(r.a)(Object(r.a)({},e),{},{source:new h.a(Object(r.a)({url:D},i))}));case"Baidu":return A(Object(r.a)({url:V},i));case"TDT":return X(Object(r.a)({layers:["vec_c","vec_w","cva_w","ibo_w"]},i));case"Founder":return q(Object(r.a)({url:"http://127.0.0.1:3000/proxy"},i));case"Ez":return Z(Object(r.a)({url:U},i));case"Super":return K(Object(r.a)({url:B},i));case"Fc":return J(Object(r.a)({url:$},i));case"WMTS":return W(i)}}},468:function(t,e,i){},512:function(t,e,i){"use strict";var r,n=i(536),o=i(408),s=i(500),a=i(545),h=i(363),c=i(509),u=i(537),l=i(407),d=i(694),p=i(510),f=i(525),g=i(592),m=i(695),y=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),_=function(t){function e(e,i){var r=t.call(this)||this;return r.flatMidpoint_=null,r.flatMidpointRevision_=-1,r.maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===i||Array.isArray(e[0])?r.setCoordinates(e,i):r.setFlatCoordinates(i,e),r}return y(e,t),e.prototype.appendCoordinate=function(t){this.flatCoordinates?Object(l.c)(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,r){return r<Object(h.e)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(a.e)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(a.d)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r))},e.prototype.forEachSegment=function(t){return Object(d.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.getCoordinateAtM=function(t,e){if(this.layout!=n.a.XYM&&this.layout!=n.a.XYZM)return null;var i=void 0!==e&&e;return Object(f.b)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)},e.prototype.getCoordinates=function(){return Object(p.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getCoordinateAt=function(t,e){return Object(f.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},e.prototype.getLength=function(){return Object(m.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[];return i.length=Object(u.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i,0),new e(i,n.a.XY)},e.prototype.getType=function(){return o.a.LINE_STRING},e.prototype.intersectsExtent=function(t){return Object(g.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Object(c.b)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(s.a);e.a=_},525:function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return a}));var r=i(407),n=i(450);function o(t,e,i,o,s,a,h){var c,u,l=(i-e)/o;if(1===l)c=e;else if(2===l)c=e,u=s;else if(0!==l){for(var d=t[e],p=t[e+1],f=0,g=[0],m=e+o;m<i;m+=o){var y=t[m],_=t[m+1];f+=Math.sqrt((y-d)*(y-d)+(_-p)*(_-p)),g.push(f),d=y,p=_}var v=s*f,b=Object(r.a)(g,v);b<0?(u=(v-g[-b-2])/(g[-b-1]-g[-b-2]),c=e+(-b-2)*o):c=e+b*o}var O=h>1?h:2,C=a||new Array(O);for(m=0;m<O;++m)C[m]=void 0===c?NaN:void 0===u?t[c+m]:Object(n.c)(t[c+m],t[c+o+m],u);return C}function s(t,e,i,r,o,s){if(i==e)return null;var a;if(o<t[e+r-1])return s?((a=t.slice(e,e+r))[r-1]=o,a):null;if(t[i-1]<o)return s?((a=t.slice(i-r,i))[r-1]=o,a):null;if(o==t[e+r-1])return t.slice(e,e+r);for(var h=e/r,c=i/r;h<c;){var u=h+c>>1;o<t[(u+1)*r-1]?c=u:h=u+1}var l=t[h*r-1];if(o==l)return t.slice((h-1)*r,(h-1)*r+r);var d=(o-l)/(t[(h+1)*r-1]-l);a=[];for(var p=0;p<r-1;++p)a.push(Object(n.c)(t[(h-1)*r+p],t[h*r+p],d));return a.push(o),a}function a(t,e,i,r,n,o,a){if(a)return s(t,e,i[i.length-1],r,n,o);var h;if(n<t[r-1])return o?((h=t.slice(0,r))[r-1]=n,h):null;if(t[t.length-1]<n)return o?((h=t.slice(t.length-r))[r-1]=n,h):null;for(var c=0,u=i.length;c<u;++c){var l=i[c];if(e!=l){if(n<t[e+r-1])return null;if(n<=t[l-1])return s(t,e,l,r,n,!1);e=l}}return null}},647:function(t,e,i){"use strict";var r,n=i(408),o=i(477),s=i(500),a=i(363),h=i(509),c=i(407),u=i(510),l=i(450),d=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),p=function(t){function e(e,i){var r=t.call(this)||this;return i&&!Array.isArray(e[0])?r.setFlatCoordinates(i,e):r.setCoordinates(e,i),r}return d(e,t),e.prototype.appendPoint=function(t){this.flatCoordinates?Object(c.c)(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout)},e.prototype.closestPointXY=function(t,e,i,r){if(r<Object(a.e)(this.getExtent(),t,e))return r;for(var n=this.flatCoordinates,o=this.stride,s=0,h=n.length;s<h;s+=o){var c=Object(l.g)(t,e,n[s],n[s+1]);if(c<r){r=c;for(var u=0;u<o;++u)i[u]=n[s+u];i.length=o}}return r},e.prototype.getCoordinates=function(){return Object(u.a)(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},e.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new o.a(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},e.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,r=[],n=0,s=t.length;n<s;n+=i){var a=new o.a(t.slice(n,n+i),e);r.push(a)}return r},e.prototype.getType=function(){return n.a.MULTI_POINT},e.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,r=0,n=e.length;r<n;r+=i){var o=e[r],s=e[r+1];if(Object(a.h)(t,o,s))return!0}return!1},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Object(h.b)(this.flatCoordinates,0,t,this.stride),this.changed()},e}(s.a);e.a=p},680:function(t,e,i){"use strict";e.a={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"}},698:function(t,e,i){"use strict";var r,n=i(495),o=i(739),s=i(680),a=i(641),h=i(363),c=i(476),u=i(543),l=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),d="element",p="map",f="offset",g="position",m="positioning",y=function(t){function e(e){var i=t.call(this)||this;i.options=e,i.id=e.id,i.insertFirst=void 0===e.insertFirst||e.insertFirst,i.stopEvent=void 0===e.stopEvent||e.stopEvent,i.element=document.createElement("div"),i.element.className=void 0!==e.className?e.className:"ol-overlay-container "+a.d,i.element.style.position="absolute",i.element.style.pointerEvents="auto";var r=e.autoPan;return r&&"object"!=typeof r&&(r={animation:e.autoPanAnimation,margin:e.autoPanMargin}),i.autoPan=r||!1,i.rendered={transform_:"",visible:!0},i.mapPostrenderListenerKey=null,i.addEventListener(Object(n.b)(d),i.handleElementChanged),i.addEventListener(Object(n.b)(p),i.handleMapChanged),i.addEventListener(Object(n.b)(f),i.handleOffsetChanged),i.addEventListener(Object(n.b)(g),i.handlePositionChanged),i.addEventListener(Object(n.b)(m),i.handlePositioningChanged),void 0!==e.element&&i.setElement(e.element),i.setOffset(void 0!==e.offset?e.offset:[0,0]),i.setPositioning(void 0!==e.positioning?e.positioning:s.a.TOP_LEFT),void 0!==e.position&&i.setPosition(e.position),i}return l(e,t),e.prototype.getElement=function(){return this.get(d)},e.prototype.getId=function(){return this.id},e.prototype.getMap=function(){return this.get(p)},e.prototype.getOffset=function(){return this.get(f)},e.prototype.getPosition=function(){return this.get(g)},e.prototype.getPositioning=function(){return this.get(m)},e.prototype.handleElementChanged=function(){Object(u.d)(this.element);var t=this.getElement();t&&this.element.appendChild(t)},e.prototype.handleMapChanged=function(){this.mapPostrenderListenerKey&&(Object(u.e)(this.element),Object(c.c)(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);var t=this.getMap();if(t){this.mapPostrenderListenerKey=Object(c.a)(t,o.a.POSTRENDER,this.render,this),this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element),this.performAutoPan()}},e.prototype.render=function(){this.updatePixelPosition()},e.prototype.handleOffsetChanged=function(){this.updatePixelPosition()},e.prototype.handlePositionChanged=function(){this.updatePixelPosition(),this.performAutoPan()},e.prototype.handlePositioningChanged=function(){this.updatePixelPosition()},e.prototype.setElement=function(t){this.set(d,t)},e.prototype.setMap=function(t){this.set(p,t)},e.prototype.setOffset=function(t){this.set(f,t)},e.prototype.setPosition=function(t){this.set(g,t)},e.prototype.performAutoPan=function(){this.autoPan&&this.panIntoView(this.autoPan)},e.prototype.panIntoView=function(t){var e=this.getMap();if(e&&e.getTargetElement()&&this.get(g)){var i=this.getRect(e.getTargetElement(),e.getSize()),r=this.getElement(),n=this.getRect(r,[Object(u.c)(r),Object(u.b)(r)]),o=t||{},s=void 0===o.margin?20:o.margin;if(!Object(h.g)(i,n)){var a=n[0]-i[0],c=i[2]-n[2],l=n[1]-i[1],d=i[3]-n[3],p=[0,0];if(a<0?p[0]=a-s:c<0&&(p[0]=Math.abs(c)+s),l<0?p[1]=l-s:d<0&&(p[1]=Math.abs(d)+s),0!==p[0]||0!==p[1]){var f=e.getView().getCenterInternal(),m=e.getPixelFromCoordinateInternal(f),y=[m[0]+p[0],m[1]+p[1]],_=o.animation||{};e.getView().animateInternal({center:e.getCoordinateFromPixelInternal(y),duration:_.duration,easing:_.easing})}}}},e.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[r,n,r+e[0],n+e[1]]},e.prototype.setPositioning=function(t){this.set(m,t)},e.prototype.setVisible=function(t){this.rendered.visible!==t&&(this.element.style.display=t?"":"none",this.rendered.visible=t)},e.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)}else this.setVisible(!1)},e.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,r=this.getOffset(),n=this.getPositioning();this.setVisible(!0);var o=Math.round(t[0]+r[0])+"px",a=Math.round(t[1]+r[1])+"px",h="0%",c="0%";n==s.a.BOTTOM_RIGHT||n==s.a.CENTER_RIGHT||n==s.a.TOP_RIGHT?h="-100%":n!=s.a.BOTTOM_CENTER&&n!=s.a.CENTER_CENTER&&n!=s.a.TOP_CENTER||(h="-50%"),n==s.a.BOTTOM_LEFT||n==s.a.BOTTOM_CENTER||n==s.a.BOTTOM_RIGHT?c="-100%":n!=s.a.CENTER_LEFT&&n!=s.a.CENTER_CENTER&&n!=s.a.CENTER_RIGHT||(c="-50%");var u="translate("+h+", "+c+") translate("+o+", "+a+")";this.rendered.transform_!=u&&(this.rendered.transform_=u,i.transform=u,i.msTransform=u)},e.prototype.getOptions=function(){return this.options},e}(n.a);e.a=y},708:function(t,e,i){"use strict";i(85),i(197);var r=i(52),n=i(698);e.a={name:"spMapHtml",inject:["myMap"],props:{id:[Number,String],offset:{type:Array,default:function(){return[0,0]}},position:Array,positioning:{type:String,default:"center-center"},stopEvent:{type:Boolean,default:!0},insertFirst:Boolean,autoPan:{type:Boolean,default:!1},autoPanAnimation:{type:Object,default:function(){return{}}},autoPanMargin:{type:Number,default:20},visible:{type:Boolean,default:!0}},render:function(){var t=arguments[0];return t("div",{class:"sp-map-html",style:this.styles,on:Object(r.a)({},this.$listeners)},[this.$slots.default])},computed:{styles:function(){return{cursor:this.$listeners.click?"pointer":""}}},watch:{$props:{deep:!0,handler:function(){try{this.dispose(),this.init()}catch(t){}}}},methods:{init:function(){if(this.$el){var t=Object(r.a)(Object(r.a)({},this.$props),{},{element:this.$el});this.overlay=new n.a(t),this.myMap.map.addOverlay(this.overlay),this.setPosition(this.position)}},setPosition:function(t){this.overlay&&this.overlay.setPosition(this.visible?t:null)},dispose:function(){this.overlay&&this.myMap&&this.myMap.map&&this.myMap.map.removeOverlay(this.overlay)}},mounted:function(){this.myMap.mapReady(this.init)},beforeDestroy:function(){this.dispose()}}},735:function(t,e,i){"use strict";var r,n=i(536),o=i(408),s=i(512),a=i(500),h=i(545),c=i(363),u=i(509),l=i(537),d=i(407),p=i(510),f=i(525),g=i(592),m=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),y=function(t){function e(e,i,r){var n=t.call(this)||this;if(n.ends_=[],n.maxDelta_=-1,n.maxDeltaRevision_=-1,Array.isArray(e[0]))n.setCoordinates(e,i);else if(void 0!==i&&r)n.setFlatCoordinates(i,e),n.ends_=r;else{for(var o=n.getLayout(),s=e,a=[],h=[],c=0,u=s.length;c<u;++c){var l=s[c];0===c&&(o=l.getLayout()),Object(d.c)(a,l.getFlatCoordinates()),h.push(a.length)}n.setFlatCoordinates(o,a),n.ends_=h}return n}return m(e,t),e.prototype.appendLineString=function(t){this.flatCoordinates?Object(d.c)(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},e.prototype.clone=function(){return new e(this.flatCoordinates.slice(),this.layout,this.ends_.slice())},e.prototype.closestPointXY=function(t,e,i,r){return r<Object(c.e)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(h.a)(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(h.b)(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r))},e.prototype.getCoordinateAtM=function(t,e,i){if(this.layout!=n.a.XYM&&this.layout!=n.a.XYZM||0===this.flatCoordinates.length)return null;var r=void 0!==e&&e,o=void 0!==i&&i;return Object(f.c)(this.flatCoordinates,0,this.ends_,this.stride,t,r,o)},e.prototype.getCoordinates=function(){return Object(p.b)(this.flatCoordinates,0,this.ends_,this.stride)},e.prototype.getEnds=function(){return this.ends_},e.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new s.a(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)},e.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[],n=0,o=0,a=e.length;o<a;++o){var h=e[o],c=new s.a(t.slice(n,h),i);r.push(c),n=h}return r},e.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,r=this.ends_,n=this.stride,o=0,s=r.length;o<s;++o){var a=r[o],h=Object(f.a)(e,i,a,n,.5);Object(d.c)(t,h),i=a}return t},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],r=[];return i.length=Object(l.b)(this.flatCoordinates,0,this.ends_,this.stride,t,i,0,r),new e(i,n.a.XY,r)},e.prototype.getType=function(){return o.a.MULTI_LINE_STRING},e.prototype.intersectsExtent=function(t){return Object(g.b)(this.flatCoordinates,0,this.ends_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var i=Object(u.c)(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1],this.changed()},e}(a.a);e.a=y},736:function(t,e,i){"use strict";var r=i(536),n=i(408),o=i(647),s=i(596),a=i(500),h=i(545),c=i(363),u=i(509),l=i(407),d=i(834),p=i(510),f=i(592),g=i(851),m=i(806);var y,_=i(760),v=i(537),b=(y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),O=function(t){function e(e,i,r){var n=t.call(this)||this;if(n.endss_=[],n.flatInteriorPointsRevision_=-1,n.flatInteriorPoints_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,!r&&!Array.isArray(e[0])){for(var o=n.getLayout(),s=e,a=[],h=[],c=0,u=s.length;c<u;++c){var d=s[c];0===c&&(o=d.getLayout());for(var p=a.length,f=d.getEnds(),g=0,m=f.length;g<m;++g)f[g]+=p;Object(l.c)(a,d.getFlatCoordinates()),h.push(f)}i=o,e=a,r=h}return void 0!==i&&r?(n.setFlatCoordinates(i,e),n.endss_=r):n.setCoordinates(e,i),n}return b(e,t),e.prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;Object(l.c)(this.flatCoordinates,t.getFlatCoordinates());for(var r=0,n=(e=t.getEnds().slice()).length;r<n;++r)e[r]+=i}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()},e.prototype.clone=function(){for(var t=this.endss_.length,i=new Array(t),r=0;r<t;++r)i[r]=this.endss_[r].slice();return new e(this.flatCoordinates.slice(),this.layout,i)},e.prototype.closestPointXY=function(t,e,i,r){return r<Object(c.e)(this.getExtent(),t,e)?r:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Object(h.f)(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Object(h.c)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r))},e.prototype.containsXY=function(t,e){return Object(_.d)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},e.prototype.getArea=function(){return Object(m.c)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},e.prototype.getCoordinates=function(t){var e;return void 0!==t?(e=this.getOrientedFlatCoordinates().slice(),Object(g.d)(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Object(p.c)(e,0,this.endss_,this.stride)},e.prototype.getEndss=function(){return this.endss_},e.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=function(t,e,i,r){for(var n=[],o=Object(c.j)(),s=0,a=i.length;s<a;++s){var h=i[s];o=Object(c.o)(t,e,h[0],r),n.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=h[h.length-1]}return n}(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Object(d.b)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},e.prototype.getInteriorPoints=function(){return new o.a(this.getFlatInteriorPoints().slice(),r.a.XYM)},e.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Object(g.b)(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Object(g.d)(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},e.prototype.getSimplifiedGeometryInternal=function(t){var i=[],n=[];return i.length=Object(v.d)(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),i,0,n),new e(i,r.a.XY,n)},e.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var r=this.endss_[t].slice(),n=r[r.length-1];if(0!==e)for(var o=0,a=r.length;o<a;++o)r[o]-=e;return new s.a(this.flatCoordinates.slice(e,n),this.layout,r)},e.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[],n=0,o=0,a=i.length;o<a;++o){var h=i[o].slice(),c=h[h.length-1];if(0!==n)for(var u=0,l=h.length;u<l;++u)h[u]-=n;var d=new s.a(e.slice(n,c),t,h);r.push(d),n=c}return r},e.prototype.getType=function(){return n.a.MULTI_POLYGON},e.prototype.intersectsExtent=function(t){return Object(f.d)(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},e.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var i=Object(u.d)(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()},e}(a.a);e.a=O},799:function(t,e,i){"use strict";var r,n=i(467),o=i(422),s=i(835),a=i(408),h=i(363),c=i(476),u=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function l(t){for(var e=[],i=0,r=t.length;i<r;++i)e.push(t[i].clone());return e}var d=function(t){function e(e){var i=t.call(this)||this;return i.geometries_=e||null,i.changeEventsKeys_=[],i.listenGeometriesChange_(),i}return u(e,t),e.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(c.c),this.changeEventsKeys_.length=0},e.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(Object(c.a)(this.geometries_[t],o.a.CHANGE,this.changed,this))},e.prototype.clone=function(){var t=new e(null);return t.setGeometries(this.geometries_),t},e.prototype.closestPointXY=function(t,e,i,r){if(r<Object(h.e)(this.getExtent(),t,e))return r;for(var n=this.geometries_,o=0,s=n.length;o<s;++o)r=n[o].closestPointXY(t,e,i,r);return r},e.prototype.containsXY=function(t,e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)if(i[r].containsXY(t,e))return!0;return!1},e.prototype.computeExtent=function(t){Object(h.l)(t);for(var e=this.geometries_,i=0,r=e.length;i<r;++i)Object(h.q)(t,e[i].getExtent());return t},e.prototype.getGeometries=function(){return l(this.geometries_)},e.prototype.getGeometriesArray=function(){return this.geometries_},e.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,i=0,r=e.length;i<r;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t},e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var i=[],r=this.geometries_,n=!1,o=0,s=r.length;o<s;++o){var a=r[o],h=a.getSimplifiedGeometry(t);i.push(h),h!==a&&(n=!0)}if(n){var c=new e(null);return c.setGeometriesArray(i),c}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},e.prototype.getType=function(){return a.a.GEOMETRY_COLLECTION},e.prototype.intersectsExtent=function(t){for(var e=this.geometries_,i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1},e.prototype.isEmpty=function(){return 0===this.geometries_.length},e.prototype.rotate=function(t,e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)i[r].rotate(t,e);this.changed()},e.prototype.scale=function(t,e,i){var r=i;r||(r=Object(h.x)(this.getExtent()));for(var n=this.geometries_,o=0,s=n.length;o<s;++o)n[o].scale(t,e,r);this.changed()},e.prototype.setGeometries=function(t){this.setGeometriesArray(l(t))},e.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},e.prototype.applyTransform=function(t){for(var e=this.geometries_,i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()},e.prototype.translate=function(t,e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)i[r].translate(t,e);this.changed()},e.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),t.prototype.disposeInternal.call(this)},e}(s.a),p=i(639),f=i(431),g=i(472),m=i(383),y=function(){function t(){this.dataProjection=null,this.defaultFeatureProjection=null}return t.prototype.getReadOptions=function(t,e){var i;if(e){var r=e.dataProjection?Object(m.j)(e.dataProjection):this.readProjection(t);e.extent&&r&&r.getUnits()===p.b.TILE_PIXELS&&(r=Object(m.j)(r)).setWorldExtent(e.extent),i={dataProjection:r,featureProjection:e.featureProjection}}return this.adaptOptions(i)},t.prototype.adaptOptions=function(t){return Object(g.a)({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)},t.prototype.getType=function(){return Object(f.b)()},t.prototype.readFeature=function(t,e){return Object(f.b)()},t.prototype.readFeatures=function(t,e){return Object(f.b)()},t.prototype.readGeometry=function(t,e){return Object(f.b)()},t.prototype.readProjection=function(t){return Object(f.b)()},t.prototype.writeFeature=function(t,e){return Object(f.b)()},t.prototype.writeFeatures=function(t,e){return Object(f.b)()},t.prototype.writeGeometry=function(t,e){return Object(f.b)()},t}();function _(t,e,i){var r,n=i?Object(m.j)(i.featureProjection):null,o=i?Object(m.j)(i.dataProjection):null;if(r=n&&o&&!Object(m.f)(n,o)?(e?t.clone():t).transform(e?n:o,e?o:n):t,e&&i&&void 0!==i.decimals){var s=Math.pow(10,i.decimals);r===t&&(r=t.clone()),r.applyTransform((function(t){for(var e=0,i=t.length;e<i;++e)t[e]=Math.round(t[e]*s)/s;return t}))}return r}var v=i(836),b=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();function O(t){if("string"==typeof t){var e=JSON.parse(t);return e||null}return null!==t?t:null}var C=function(t){function e(){return t.call(this)||this}return b(e,t),e.prototype.getType=function(){return v.a.JSON},e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(O(t),this.getReadOptions(t,e))},e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(O(t),this.getReadOptions(t,e))},e.prototype.readFeatureFromObject=function(t,e){return Object(f.b)()},e.prototype.readFeaturesFromObject=function(t,e){return Object(f.b)()},e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(O(t),this.getReadOptions(t,e))},e.prototype.readGeometryFromObject=function(t,e){return Object(f.b)()},e.prototype.readProjection=function(t){return this.readProjectionFromObject(O(t))},e.prototype.readProjectionFromObject=function(t){return Object(f.b)()},e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},e.prototype.writeFeatureObject=function(t,e){return Object(f.b)()},e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},e.prototype.writeFeaturesObject=function(t,e){return Object(f.b)()},e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},e.prototype.writeGeometryObject=function(t,e){return Object(f.b)()},e}(y),j=i(512),w=i(735),P=i(647),E=i(736),T=i(477),x=i(596),F=i(473),S=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),M=function(t){function e(e){var i=this,r=e||{};return(i=t.call(this)||this).dataProjection=Object(m.j)(r.dataProjection?r.dataProjection:"EPSG:4326"),r.featureProjection&&(i.defaultFeatureProjection=Object(m.j)(r.featureProjection)),i.geometryName_=r.geometryName,i.extractGeometryName_=r.extractGeometryName,i}return S(e,t),e.prototype.readFeatureFromObject=function(t,e){var i=null,r=G((i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),o=new n.a;return this.geometryName_?o.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&o.setGeometryName(i.geometry_name),o.setGeometry(r),"id"in i&&o.setId(i.id),i.properties&&o.setProperties(i.properties,!0),o},e.prototype.readFeaturesFromObject=function(t,e){var i=null;if("FeatureCollection"===t.type){i=[];for(var r=t.features,n=0,o=r.length;n<o;++n)i.push(this.readFeatureFromObject(r[n],e))}else i=[this.readFeatureFromObject(t,e)];return i},e.prototype.readGeometryFromObject=function(t,e){return G(t,e)},e.prototype.readProjectionFromObject=function(t){var e,i=t.crs;return i?"name"==i.type?e=Object(m.j)(i.properties.name):"EPSG"===i.type?e=Object(m.j)("EPSG:"+i.properties.code):Object(F.a)(!1,36):e=this.dataProjection,e},e.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={type:"Feature",geometry:null,properties:null},r=t.getId();if(void 0!==r&&(i.id=r),!t.hasProperties())return i;var n=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=I(o,e),delete n[t.getGeometryName()]),Object(g.d)(n)||(i.properties=n),i},e.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],r=0,n=t.length;r<n;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}},e.prototype.writeGeometryObject=function(t,e){return I(t,this.adaptOptions(e))},e}(C);function G(t,e){if(!t)return null;var i;switch(t.type){case a.a.POINT:i=function(t){return new T.a(t.coordinates)}(t);break;case a.a.LINE_STRING:i=function(t){return new j.a(t.coordinates)}(t);break;case a.a.POLYGON:i=function(t){return new x.a(t.coordinates)}(t);break;case a.a.MULTI_POINT:i=function(t){return new P.a(t.coordinates)}(t);break;case a.a.MULTI_LINE_STRING:i=function(t){return new w.a(t.coordinates)}(t);break;case a.a.MULTI_POLYGON:i=function(t){return new E.a(t.coordinates)}(t);break;case a.a.GEOMETRY_COLLECTION:i=function(t,e){var i=t.geometries.map((function(t){return G(t,e)}));return new d(i)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return _(i,!1,e)}function I(t,e){var i,r=(t=_(t,!0,e)).getType();switch(r){case a.a.POINT:i=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case a.a.LINE_STRING:i=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case a.a.POLYGON:i=function(t,e){var i;e&&(i=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case a.a.MULTI_POINT:i=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case a.a.MULTI_LINE_STRING:i=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case a.a.MULTI_POLYGON:i=function(t,e){var i;e&&(i=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case a.a.GEOMETRY_COLLECTION:i=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){var i=Object(g.a)({},e);return delete i.featureProjection,I(t,i)}))}}(t,e);break;case a.a.CIRCLE:i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+r)}return i}e.a=M},932:function(t,e,i){"use strict";var r=i(53),n=i(708);e.a=Object(r.a)(n.a)},962:function(t,e,i){"use strict";var r,n=i(931),o=i(633),s=i(422),a=i(467),h=i(408),c=i(959),u=i(512),l=i(876),d=i(725),p=i(735),f=i(647),g=i(736),m=i(477),y=i(474),_=i(596),v=i(528),b=i(513),O=i(589),C=i(662),j=(i(363),i(838)),w=i(383),P=i(495),E=i(613),T=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),x="Point",F="LineString",S="Polygon",M="Circle",G="drawstart",I="drawend",L="drawabort",R=function(t){function e(e,i){var r=t.call(this,e)||this;return r.feature=i,r}return T(e,t),e}(o.a),k=function(t){function e(e){var i=this,r=e;r.stopDown||(r.stopDown=O.a),(i=t.call(this,r)||this).shouldHandle_=!1,i.downPx_=null,i.downTimeout_,i.lastDragTime_,i.freehand_=!1,i.source_=e.source?e.source:null,i.features_=e.features?e.features:null,i.snapTolerance_=e.snapTolerance?e.snapTolerance:12,i.type_=e.type,i.mode_=function(t){var e;t===h.a.POINT||t===h.a.MULTI_POINT?e=x:t===h.a.LINE_STRING||t===h.a.MULTI_LINE_STRING?e=F:t===h.a.POLYGON||t===h.a.MULTI_POLYGON?e=S:t===h.a.CIRCLE&&(e=M);return e}(i.type_),i.stopClick_=!!e.stopClick,i.minPoints_=e.minPoints?e.minPoints:i.mode_===S?3:2,i.maxPoints_=e.maxPoints?e.maxPoints:1/0,i.finishCondition_=e.finishCondition?e.finishCondition:O.b;var o,s=e.geometryFunction;if(!s)if(i.type_===h.a.CIRCLE)s=function(t,e,i){var r=e||new n.a([NaN,NaN]),o=Object(w.h)(t[0],i),s=Object(E.i)(o,Object(w.h)(t[1],i));r.setCenterAndRadius(o,Math.sqrt(s));var a=Object(w.n)();return a&&r.transform(i,a),r};else{var a,l=i.mode_;l===x?a=m.a:l===F?a=u.a:l===S&&(a=_.a),s=function(t,e,i){var r=e;return r?l===S?t[0].length?r.setCoordinates([t[0].concat([t[0][0]])]):r.setCoordinates([]):r.setCoordinates(t):r=new a(t),r}}return i.geometryFunction_=s,i.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,i.finishCoordinate_=null,i.sketchFeature_=null,i.sketchPoint_=null,i.sketchCoords_=null,i.sketchLine_=null,i.sketchLineCoords_=null,i.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,i.overlay_=new v.a({source:new b.a({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:(o=Object(j.b)(),function(t,e){return o[t.getGeometry().getType()]}),updateWhileInteracting:!0}),i.geometryName_=e.geometryName,i.condition_=e.condition?e.condition:C.h,i.freehandCondition_,e.freehand?i.freehandCondition_=C.d:i.freehandCondition_=e.freehandCondition?e.freehandCondition:C.j,i.addEventListener(Object(P.b)(c.a.ACTIVE),i.updateState_),i}return T(e,t),e.prototype.setMap=function(e){t.prototype.setMap.call(this,e),this.updateState_()},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleEvent=function(e){e.originalEvent.type===s.a.CONTEXTMENU&&e.preventDefault(),this.freehand_=this.mode_!==x&&this.freehandCondition_(e);var i=e.type===d.a.POINTERMOVE,r=!0;!this.freehand_&&this.lastDragTime_&&e.type===d.a.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,i=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0));return this.freehand_&&e.type===d.a.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),r=!1):this.freehand_&&e.type===d.a.POINTERDOWN?r=!1:i?(r=e.type===d.a.POINTERMOVE)&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.preventDefault()):("mouse"==e.originalEvent.pointerType||e.type===d.a.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e):e.type===d.a.DBLCLICK&&(r=!1),t.prototype.handleEvent.call(this,e)&&r},e.prototype.handleDownEvent=function(t){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=t.pixel,this.finishCoordinate_||this.startDrawing_(t),!0):this.condition_(t)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new l.a(d.a.POINTERMOVE,t.map,t.originalEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_),this.downPx_=t.pixel,!0):(this.lastDragTime_=void 0,!1)},e.prototype.handleUpEvent=function(t){var e=!0;this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(t);var i=this.mode_===M;return this.shouldHandle_?(this.finishCoordinate_?this.freehand_||i?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t.coordinate):(this.startDrawing_(t),this.mode_===x&&this.finishDrawing()),e=!1):this.freehand_&&this.abortDrawing(),!e&&this.stopClick_&&t.stopPropagation(),e},e.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,r=e[0]-i[0],n=e[1]-i[1],o=r*r+n*n;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t)},e.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,r=[this.finishCoordinate_];if(this.mode_===F)i=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===S){var n=this.sketchCoords_;i=n[0].length>this.minPoints_,r=[n[0][0],n[0][n[0].length-2]]}if(i)for(var o=t.map,s=0,a=r.length;s<a;s++){var h=r[s],c=o.getPixelFromCoordinate(h),u=t.pixel,l=u[0]-c[0],d=u[1]-c[1],p=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(l*l+d*d)<=p){this.finishCoordinate_=h;break}}}return e},e.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new a.a(new m.a(e)),this.updateSketchFeatures_())},e.prototype.startDrawing_=function(t){var e=t.coordinate,i=t.map.getView().getProjection();this.finishCoordinate_=e,this.mode_===x?this.sketchCoords_=e.slice():this.mode_===S?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new a.a(new u.a(this.sketchLineCoords_)));var r=this.geometryFunction_(this.sketchCoords_,void 0,i);this.sketchFeature_=new a.a,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(r),this.updateSketchFeatures_(),this.dispatchEvent(new R(G,this.sketchFeature_))},e.prototype.modifyDrawing_=function(t){var e,i,r,n=t.coordinate,o=this.sketchFeature_.getGeometry(),s=t.map.getView().getProjection();(this.mode_===x?i=this.sketchCoords_:this.mode_===S?(i=(e=this.sketchCoords_[0])[e.length-1],this.atFinish_(t)&&(n=this.finishCoordinate_.slice())):i=(e=this.sketchCoords_)[e.length-1],i[0]=n[0],i[1]=n[1],this.geometryFunction_(this.sketchCoords_,o,s),this.sketchPoint_)&&this.sketchPoint_.getGeometry().setCoordinates(n);if(o.getType()==h.a.POLYGON&&this.mode_!==S){this.sketchLine_||(this.sketchLine_=new a.a);var c=o.getLinearRing(0);(r=this.sketchLine_.getGeometry())?(r.setFlatCoordinates(c.getLayout(),c.getFlatCoordinates()),r.changed()):(r=new u.a(c.getFlatCoordinates(),c.getLayout()),this.sketchLine_.setGeometry(r))}else this.sketchLineCoords_&&(r=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()},e.prototype.addToDrawing_=function(t){var e,i,r=this.sketchFeature_.getGeometry(),n=this.getMap().getView().getProjection();this.mode_===F?(this.finishCoordinate_=t.slice(),(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),this.geometryFunction_(i,r,n)):this.mode_===S&&((i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0),i.push(t.slice()),e&&(this.finishCoordinate_=i[0]),this.geometryFunction_(this.sketchCoords_,r,n)),this.updateSketchFeatures_(),e&&this.finishDrawing()},e.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();this.mode_===F?((t=this.sketchCoords_).splice(-2,1),this.geometryFunction_(t,e,i),t.length>=2&&(this.finishCoordinate_=t[t.length-2].slice())):this.mode_===S&&((t=this.sketchCoords_[0]).splice(-2,1),this.sketchLine_.getGeometry().setCoordinates(t),this.geometryFunction_(this.sketchCoords_,e,i)),0===t.length&&this.abortDrawing(),this.updateSketchFeatures_()}},e.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry(),r=this.getMap().getView().getProjection();this.mode_===F?(e.pop(),this.geometryFunction_(e,i,r)):this.mode_===S&&(e[0].pop(),this.geometryFunction_(e,i,r),e=i.getCoordinates()),this.type_===h.a.MULTI_POINT?t.setGeometry(new f.a([e])):this.type_===h.a.MULTI_LINE_STRING?t.setGeometry(new p.a([e])):this.type_===h.a.MULTI_POLYGON&&t.setGeometry(new g.a([e])),this.dispatchEvent(new R(I,t)),this.features_&&this.features_.push(t),this.source_&&this.source_.addFeature(t)}},e.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),t},e.prototype.abortDrawing=function(){var t=this.abortDrawing_();t&&this.dispatchEvent(new R(L,t))},e.prototype.appendCoordinates=function(t){var e=this.mode_,i=[];e===F?i=this.sketchCoords_:e===S&&(i=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]);for(var r=i.pop(),n=0;n<t.length;n++)this.addToDrawing_(t[n]);this.addToDrawing_(r)},e.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t,this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.updateSketchFeatures_(),this.dispatchEvent(new R(G,this.sketchFeature_))},e.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_),this.sketchLine_&&t.push(this.sketchLine_),this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0),e.addFeatures(t)},e.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing(),this.overlay_.setMap(e?t:null)},e}(y.b);e.a=k},963:function(t,e,i){"use strict";var r,n=i(738),o=i(422),s=i(408),a=i(474),h=i(837),c=i(831),u=i(589),l=i(363),d=i(613),p=i(596),f=i(383),g=i(431),m=i(472),y=i(476),_=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});function v(t){return t.feature?t.feature:t.element?t.element:void 0}var b=[],O=function(t){function e(e){var i=this,r=e||{},n=r;return n.handleDownEvent||(n.handleDownEvent=u.b),n.stopDown||(n.stopDown=u.a),(i=t.call(this,n)||this).source_=r.source?r.source:null,i.vertex_=void 0===r.vertex||r.vertex,i.edge_=void 0===r.edge||r.edge,i.features_=r.features?r.features:null,i.featuresListenerKeys_=[],i.featureChangeListenerKeys_={},i.indexedFeaturesExtents_={},i.pendingFeatures_={},i.pixelTolerance_=void 0!==r.pixelTolerance?r.pixelTolerance:10,i.rBush_=new h.a,i.SEGMENT_WRITERS_={Point:i.writePointGeometry_.bind(i),LineString:i.writeLineStringGeometry_.bind(i),LinearRing:i.writeLineStringGeometry_.bind(i),Polygon:i.writePolygonGeometry_.bind(i),MultiPoint:i.writeMultiPointGeometry_.bind(i),MultiLineString:i.writeMultiLineStringGeometry_.bind(i),MultiPolygon:i.writeMultiPolygonGeometry_.bind(i),GeometryCollection:i.writeGeometryCollectionGeometry_.bind(i),Circle:i.writeCircleGeometry_.bind(i)},i}return _(e,t),e.prototype.addFeature=function(t,e){var i=void 0===e||e,r=Object(g.c)(t),n=t.getGeometry();if(n){var s=this.SEGMENT_WRITERS_[n.getType()];s&&(this.indexedFeaturesExtents_[r]=n.getExtent(Object(l.j)()),s(t,n))}i&&(this.featureChangeListenerKeys_[r]=Object(y.a)(t,o.a.CHANGE,this.handleFeatureChange_,this))},e.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)},e.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)},e.prototype.getFeatures_=function(){var t;return this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures()),t},e.prototype.handleEvent=function(e){var i=this.snapTo(e.pixel,e.coordinate,e.map);return i.snapped&&(e.coordinate=i.vertex.slice(0,2),e.pixel=i.vertexPixel),t.prototype.handleEvent.call(this,e)},e.prototype.handleFeatureAdd_=function(t){var e=v(t);this.addFeature(e)},e.prototype.handleFeatureRemove_=function(t){var e=v(t);this.removeFeature(e)},e.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=Object(g.c)(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)},e.prototype.handleUpEvent=function(t){var e=Object(m.c)(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1},e.prototype.removeFeature=function(t,e){var i=void 0===e||e,r=Object(g.c)(t),n=this.indexedFeaturesExtents_[r];if(n){var o=this.rBush_,s=[];o.forEachInExtent(n,(function(e){t===e.feature&&s.push(e)}));for(var a=s.length-1;a>=0;--a)o.remove(s[a])}i&&(Object(y.c)(this.featureChangeListenerKeys_[r]),delete this.featureChangeListenerKeys_[r])},e.prototype.setMap=function(e){var i=this.getMap(),r=this.featuresListenerKeys_,o=this.getFeatures_();i&&(r.forEach(y.c),r.length=0,o.forEach(this.forEachFeatureRemove_.bind(this))),t.prototype.setMap.call(this,e),e&&(this.features_?r.push(Object(y.a)(this.features_,n.a.ADD,this.handleFeatureAdd_,this),Object(y.a)(this.features_,n.a.REMOVE,this.handleFeatureRemove_,this)):this.source_&&r.push(Object(y.a)(this.source_,c.a.ADDFEATURE,this.handleFeatureAdd_,this),Object(y.a)(this.source_,c.a.REMOVEFEATURE,this.handleFeatureRemove_,this)),o.forEach(this.forEachFeatureAdd_.bind(this)))},e.prototype.snapTo=function(t,e,i){var r=i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),n=i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_]),o=Object(l.b)([r,n]),a=this.rBush_.getInExtent(o);this.vertex_&&!this.edge_&&(a=a.filter((function(t){return t.feature.getGeometry().getType()!==s.a.CIRCLE})));var h=!1,c=null,u=null;if(0===a.length)return{snapped:h,vertex:c,vertexPixel:u};for(var p,g=i.getView().getProjection(),m=Object(f.h)(e,g),y=1/0,_=0;_<a.length;++_){var v=a[_];b[0]=Object(f.h)(v.segment[0],g),b[1]=Object(f.h)(v.segment[1],g);var O=Object(d.j)(m,b);O<y&&(p=v,y=O)}var C=p.segment;if(this.vertex_&&!this.edge_){var j=i.getPixelFromCoordinate(C[0]),w=i.getPixelFromCoordinate(C[1]),P=Object(d.i)(t,j),E=Object(d.i)(t,w);Math.sqrt(Math.min(P,E))<=this.pixelTolerance_&&(h=!0,c=P>E?C[1]:C[0],u=i.getPixelFromCoordinate(c))}else if(this.edge_){var T=p.feature.getGeometry().getType()===s.a.CIRCLE;if(T){var x=p.feature.getGeometry(),F=Object(f.n)();F&&(x=x.clone().transform(F,g)),c=Object(f.p)(Object(d.b)(m,x),g)}else b[0]=Object(f.h)(C[0],g),b[1]=Object(f.h)(C[1],g),c=Object(f.p)(Object(d.c)(m,b),g);if(u=i.getPixelFromCoordinate(c),Object(d.d)(t,u)<=this.pixelTolerance_&&(h=!0,this.vertex_&&!T)){j=i.getPixelFromCoordinate(C[0]),w=i.getPixelFromCoordinate(C[1]),P=Object(d.i)(u,j),E=Object(d.i)(u,w);Math.sqrt(Math.min(P,E))<=this.pixelTolerance_&&(c=P>E?C[1]:C[0],u=i.getPixelFromCoordinate(c))}}return h&&(u=[Math.round(u[0]),Math.round(u[1])]),{snapped:h,vertex:c,vertexPixel:u}},e.prototype.updateFeature_=function(t){this.removeFeature(t,!1),this.addFeature(t,!1)},e.prototype.writeCircleGeometry_=function(t,e){var i=this.getMap().getView().getProjection(),r=e,n=Object(f.n)();n&&(r=r.clone().transform(n,i));var o=Object(p.b)(r);n&&o.transform(i,n);for(var s=o.getCoordinates()[0],a=0,h=s.length-1;a<h;++a){var c=s.slice(a,a+2),u={feature:t,segment:c};this.rBush_.insert(Object(l.b)(c),u)}},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var n=this.SEGMENT_WRITERS_[i[r].getType()];n&&n(t,i[r])}},e.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),s={feature:t,segment:o};this.rBush_.insert(Object(l.b)(o),s)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),c={feature:t,segment:h};this.rBush_.insert(Object(l.b)(h),c)}},e.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r){var o=i[r],s={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length;s<a;++s)for(var h=o[s],c=0,u=h.length-1;c<u;++c){var d=h.slice(c,c+2),p={feature:t,segment:d};this.rBush_.insert(Object(l.b)(d),p)}},e.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)},e.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),c={feature:t,segment:h};this.rBush_.insert(Object(l.b)(h),c)}},e}(a.b);e.a=O},964:function(t,e,i){"use strict";var r,n=i(754),o=i(738),s=i(633),a=i(422),h=i(467),c=i(408),u=i(725),l=i(477),d=i(474),p=i(837),f=i(831),g=i(528),m=i(513),y=i(662),_=i(363),v=i(613),b=i(838),O=i(407),C=i(596),j=i(383),w=i(431),P=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),E=[0,0,0,0],T=[],x="modifystart",F="modifyend",S=function(t){function e(e,i,r){var n=t.call(this,e)||this;return n.features=i,n.mapBrowserEvent=r,n}return P(e,t),e}(s.a),M=function(t){function e(e){var i,r,s=t.call(this,e)||this;if(s.boundHandleFeatureChange_=s.handleFeatureChange_.bind(s),s.condition_=e.condition?e.condition:y.i,s.defaultDeleteCondition_=function(t){return Object(y.b)(t)&&Object(y.k)(t)},s.deleteCondition_=e.deleteCondition?e.deleteCondition:s.defaultDeleteCondition_,s.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:y.d,s.vertexFeature_=null,s.vertexSegments_=null,s.lastPixel_=[0,0],s.ignoreNextSingleClick_=!1,s.modified_=!1,s.rBush_=new p.a,s.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,s.snappedToVertex_=!1,s.changingFeature_=!1,s.dragSegments_=[],s.overlay_=new g.a({source:new m.a({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:(i=Object(b.b)(),function(t,e){return i[c.a.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0}),s.SEGMENT_WRITERS_={Point:s.writePointGeometry_.bind(s),LineString:s.writeLineStringGeometry_.bind(s),LinearRing:s.writeLineStringGeometry_.bind(s),Polygon:s.writePolygonGeometry_.bind(s),MultiPoint:s.writeMultiPointGeometry_.bind(s),MultiLineString:s.writeMultiLineStringGeometry_.bind(s),MultiPolygon:s.writeMultiPolygonGeometry_.bind(s),Circle:s.writeCircleGeometry_.bind(s),GeometryCollection:s.writeGeometryCollectionGeometry_.bind(s)},s.source_=null,e.source?(s.source_=e.source,r=new n.a(s.source_.getFeatures()),s.source_.addEventListener(f.a.ADDFEATURE,s.handleSourceAdd_.bind(s)),s.source_.addEventListener(f.a.REMOVEFEATURE,s.handleSourceRemove_.bind(s))):r=e.features,!r)throw new Error("The modify interaction requires features or a source");return s.features_=r,s.features_.forEach(s.addFeature_.bind(s)),s.features_.addEventListener(o.a.ADD,s.handleFeatureAdd_.bind(s)),s.features_.addEventListener(o.a.REMOVE,s.handleFeatureRemove_.bind(s)),s.lastPointerEvent_=null,s}return P(e,t),e.prototype.addFeature_=function(t){var e=t.getGeometry();if(e){var i=this.SEGMENT_WRITERS_[e.getType()];i&&i(t,e)}var r=this.getMap();r&&r.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,r),t.addEventListener(a.a.CHANGE,this.boundHandleFeatureChange_)},e.prototype.willModifyFeatures_=function(t){this.modified_||(this.modified_=!0,this.dispatchEvent(new S(x,this.features_,t)))},e.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.removeEventListener(a.a.CHANGE,this.boundHandleFeatureChange_)},e.prototype.removeFeatureSegmentData_=function(t){var e=this.rBush_,i=[];e.forEach((function(e){t===e.feature&&i.push(e)}));for(var r=i.length-1;r>=0;--r){for(var n=i[r],o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===n&&this.dragSegments_.splice(o,1);e.remove(n)}},e.prototype.setActive=function(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),t.prototype.setActive.call(this,e)},e.prototype.setMap=function(e){this.overlay_.setMap(e),t.prototype.setMap.call(this,e)},e.prototype.getOverlay=function(){return this.overlay_},e.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)},e.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)},e.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)},e.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e),this.addFeature_(e)}},e.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)},e.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)},e.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r){var o=i[r],s={feature:t,geometry:e,depth:[r],index:r,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}},e.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),s={feature:t,geometry:e,index:r,segment:o};this.rBush_.insert(Object(_.b)(o),s)}},e.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),c={feature:t,geometry:e,depth:[r],index:s,segment:h};this.rBush_.insert(Object(_.b)(h),c)}},e.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),c={feature:t,geometry:e,depth:[r],index:s,segment:h};this.rBush_.insert(Object(_.b)(h),c)}},e.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length;s<a;++s)for(var h=o[s],c=0,u=h.length-1;c<u;++c){var l=h.slice(c,c+2),d={feature:t,geometry:e,depth:[s,r],index:c,segment:l};this.rBush_.insert(Object(_.b)(l),d)}},e.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),r={feature:t,geometry:e,index:0,segment:[i,i]},n={feature:t,geometry:e,index:1,segment:[i,i]},o=[r,n];r.featureSegments=o,n.featureSegments=o,this.rBush_.insert(Object(_.m)(i),r);var s=e,a=Object(j.n)();if(a&&this.getMap()){var h=this.getMap().getView().getProjection();s=s.clone().transform(a,h),s=Object(C.b)(s).transform(h,a)}this.rBush_.insert(s.getExtent(),n)},e.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var n=i[r];(0,this.SEGMENT_WRITERS_[n.getType()])(t,n)}},e.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;e?e.getGeometry().setCoordinates(t):(e=new h.a(new l.a(t)),this.vertexFeature_=e,this.overlay_.getSource().addFeature(e));return e},e.prototype.handleEvent=function(e){return!e.originalEvent||(this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=u.a.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(i=!(e.type!=u.a.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==u.a.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),t.prototype.handleEvent.call(this,e)&&!i);var i},e.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(t);for(var e=t.coordinate,i=0,r=this.dragSegments_.length;i<r;++i){for(var n=this.dragSegments_[i],o=n[0],s=o.depth,a=o.geometry,h=void 0,u=o.segment,l=n[1];e.length<a.getStride();)e.push(u[l][e.length]);switch(a.getType()){case c.a.POINT:h=e,u[0]=e,u[1]=e;break;case c.a.MULTI_POINT:(h=a.getCoordinates())[o.index]=e,u[0]=e,u[1]=e;break;case c.a.LINE_STRING:(h=a.getCoordinates())[o.index+l]=e,u[l]=e;break;case c.a.MULTI_LINE_STRING:case c.a.POLYGON:(h=a.getCoordinates())[s[0]][o.index+l]=e,u[l]=e;break;case c.a.MULTI_POLYGON:(h=a.getCoordinates())[s[1]][s[0]][o.index+l]=e,u[l]=e;break;case c.a.CIRCLE:if(u[0]=e,u[1]=e,0===o.index)this.changingFeature_=!0,a.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;var d=t.map.getView().getProjection(),p=Object(v.d)(Object(j.h)(a.getCenter(),d),Object(j.h)(e,d)),f=Object(j.n)();if(f){var g=a.clone().transform(f,d);g.setRadius(p),p=g.transform(d,f).getRadius()}a.setRadius(p),this.changingFeature_=!1}}h&&this.setGeometryCoordinates_(a,h)}this.createOrUpdateVertexFeature_(e)},e.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;var e=t.coordinate;this.handlePointerAtPixel_(t.pixel,t.map,e),this.dragSegments_.length=0,this.modified_=!1;var i=this.vertexFeature_;if(i){var r=t.map.getView().getProjection(),n=[],o=i.getGeometry().getCoordinates(),s=Object(_.b)([o]),a=this.rBush_.getInExtent(s),h={};a.sort(G);for(var u=0,l=a.length;u<l;++u){var d=a[u],p=d.segment,f=Object(w.c)(d.geometry),g=d.depth;if(g&&(f+="-"+g.join("-")),h[f]||(h[f]=new Array(2)),d.geometry.getType()!==c.a.CIRCLE||1!==d.index)if(!Object(v.e)(p[0],o)||h[f][0])if(!Object(v.e)(p[1],o)||h[f][1])Object(w.c)(p)in this.vertexSegments_&&!h[f][0]&&!h[f][1]&&this.insertVertexCondition_(t)&&n.push([d,o]);else{if((d.geometry.getType()===c.a.LINE_STRING||d.geometry.getType()===c.a.MULTI_LINE_STRING)&&h[f][0]&&0===h[f][0].index)continue;this.dragSegments_.push([d,1]),h[f][1]=d}else this.dragSegments_.push([d,0]),h[f][0]=d;else{var m=L(e,d,r);Object(v.e)(m,o)&&!h[f][0]&&(this.dragSegments_.push([d,0]),h[f][0]=d)}}n.length&&this.willModifyFeatures_(t);for(var y=n.length-1;y>=0;--y)this.insertVertex_.apply(this,n[y])}return!!this.vertexFeature_},e.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;e>=0;--e){var i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()===c.a.CIRCLE){var n=r.getCenter(),o=i.featureSegments[0],s=i.featureSegments[1];o.segment[0]=n,o.segment[1]=n,s.segment[0]=n,s.segment[1]=n,this.rBush_.update(Object(_.m)(n),o);var a=r,h=Object(j.n)();if(h){var u=t.map.getView().getProjection();a=a.clone().transform(h,u),a=Object(C.b)(a).transform(u,h)}this.rBush_.update(a.getExtent(),s)}else this.rBush_.update(Object(_.b)(i.segment),i)}return this.modified_&&(this.dispatchEvent(new S(F,this.features_,t)),this.modified_=!1),!1},e.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel,this.handlePointerAtPixel_(t.pixel,t.map,t.coordinate)},e.prototype.handlePointerAtPixel_=function(t,e,i){var r=i||e.getCoordinateFromPixel(t),n=e.getView().getProjection(),o=Object(j.i)(Object(_.m)(r,E),n),s=e.getView().getResolution()*this.pixelTolerance_,a=Object(j.q)(Object(_.c)(o,s,E),n),h=this.rBush_.getInExtent(a);if(h.length>0){h.sort((function(t,e){return I(r,t,n)-I(r,e,n)}));var u=h[0],l=u.segment,d=L(r,u,n),p=e.getPixelFromCoordinate(d),f=Object(v.d)(t,p);if(f<=this.pixelTolerance_){var g={};if(u.geometry.getType()===c.a.CIRCLE&&1===u.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d);else{var m=e.getPixelFromCoordinate(l[0]),y=e.getPixelFromCoordinate(l[1]),b=Object(v.i)(p,m),O=Object(v.i)(p,y);f=Math.sqrt(Math.min(b,O)),this.snappedToVertex_=f<=this.pixelTolerance_,this.snappedToVertex_&&(d=b>O?l[1]:l[0]),this.createOrUpdateVertexFeature_(d);for(var C=1,P=h.length;C<P;++C){var T=h[C].segment;if(!(Object(v.e)(l[0],T[0])&&Object(v.e)(l[1],T[1])||Object(v.e)(l[0],T[1])&&Object(v.e)(l[1],T[0])))break;g[Object(w.c)(T)]=!0}}return g[Object(w.c)(l)]=!0,void(this.vertexSegments_=g)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},e.prototype.insertVertex_=function(t,e){for(var i,r=t.segment,n=t.feature,o=t.geometry,s=t.depth,a=t.index;e.length<o.getStride();)e.push(0);switch(o.getType()){case c.a.MULTI_LINE_STRING:case c.a.POLYGON:(i=o.getCoordinates())[s[0]].splice(a+1,0,e);break;case c.a.MULTI_POLYGON:(i=o.getCoordinates())[s[1]][s[0]].splice(a+1,0,e);break;case c.a.LINE_STRING:(i=o.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(o,i);var h=this.rBush_;h.remove(t),this.updateSegmentIndices_(o,a,s,1);var u={segment:[r[0],e],feature:n,geometry:o,depth:s,index:a};h.insert(Object(_.b)(u.segment),u),this.dragSegments_.push([u,1]);var l={segment:[e,r[1]],feature:n,geometry:o,depth:s,index:a+1};h.insert(Object(_.b)(l.segment),l),this.dragSegments_.push([l,0]),this.ignoreNextSingleClick_=!0},e.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=u.a.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t);var e=this.removeVertex_();return this.dispatchEvent(new S(F,this.features_,t)),this.modified_=!1,e}return!1},e.prototype.removeVertex_=function(){var t,e,i,r,n,o,s,a,h,u,l,d=this.dragSegments_,p={},f=!1;for(n=d.length-1;n>=0;--n)u=(i=d[n])[0],l=Object(w.c)(u.feature),u.depth&&(l+="-"+u.depth.join("-")),l in p||(p[l]={}),0===i[1]?(p[l].right=u,p[l].index=u.index):1==i[1]&&(p[l].left=u,p[l].index=u.index+1);for(l in p){switch(h=p[l].right,s=p[l].left,(a=(o=p[l].index)-1)<0&&(a=0),t=e=(r=(u=void 0!==s?s:h).geometry).getCoordinates(),f=!1,r.getType()){case c.a.MULTI_LINE_STRING:e[u.depth[0]].length>2&&(e[u.depth[0]].splice(o,1),f=!0);break;case c.a.LINE_STRING:e.length>2&&(e.splice(o,1),f=!0);break;case c.a.MULTI_POLYGON:t=t[u.depth[1]];case c.a.POLYGON:(t=t[u.depth[0]]).length>4&&(o==t.length-1&&(o=0),t.splice(o,1),f=!0,0===o&&(t.pop(),t.push(t[0]),a=t.length-1))}if(f){this.setGeometryCoordinates_(r,e);var g=[];if(void 0!==s&&(this.rBush_.remove(s),g.push(s.segment[0])),void 0!==h&&(this.rBush_.remove(h),g.push(h.segment[1])),void 0!==s&&void 0!==h){var m={depth:u.depth,feature:u.feature,geometry:u.geometry,index:a,segment:g};this.rBush_.insert(Object(_.b)(m.segment),m)}this.updateSegmentIndices_(r,o,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),d.length=0}}return f},e.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0,t.setCoordinates(e),this.changingFeature_=!1},e.prototype.updateSegmentIndices_=function(t,e,i,r){this.rBush_.forEachInExtent(t.getExtent(),(function(n){n.geometry===t&&(void 0===i||void 0===n.depth||Object(O.b)(n.depth,i))&&n.index>e&&(n.index+=r)}))},e}(d.b);function G(t,e){return t.index-e.index}function I(t,e,i){var r=e.geometry;if(r.getType()===c.a.CIRCLE){var n=r;if(1===e.index){var o=Object(j.n)();o&&(n=n.clone().transform(o,i));var s=Object(v.i)(n.getCenter(),Object(j.h)(t,i)),a=Math.sqrt(s)-n.getRadius();return a*a}}var h=Object(j.h)(t,i);return T[0]=Object(j.h)(e.segment[0],i),T[1]=Object(j.h)(e.segment[1],i),Object(v.j)(h,T)}function L(t,e,i){var r=e.geometry;if(r.getType()===c.a.CIRCLE&&1===e.index){var n=r,o=Object(j.n)();return o&&(n=n.clone().transform(o,i)),Object(j.p)(n.getClosestPoint(Object(j.h)(t,i)),i)}var s=Object(j.h)(t,i);return T[0]=Object(j.h)(e.segment[0],i),T[1]=Object(j.h)(e.segment[1],i),Object(j.p)(Object(v.c)(s,T),i)}e.a=M}}]);