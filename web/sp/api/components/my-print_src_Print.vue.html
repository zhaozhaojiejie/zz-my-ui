<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>sp-print/src/Print.vue - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Outline.html">Outline</a></li><li><a href="Tag.html">Tag</a></li><li><a href="TagCanvas.html">TagCanvas</a></li></ul><h3>Modules</h3><ul><li><a href="module-$ui_components_my-affix.html">$ui/components/sp-affix</a></li><li><a href="module-$ui_components_my-anchor.html">$ui/components/sp-anchor</a></li><li><a href="module-$ui_components_my-autocomplete.html">$ui/components/sp-autocomplete</a></li><li><a href="module-$ui_components_my-avatar.html">$ui/components/sp-avatar</a></li><li><a href="module-$ui_components_my-avatars.html">$ui/components/sp-avatars</a></li><li><a href="module-$ui_components_my-back-top.html">$ui/components/sp-back-top</a></li><li><a href="module-$ui_components_my-capture.html">$ui/components/sp-capture</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-capture.html#~_renderImg">_renderImg</a></li></ul></li><li><a href="module-$ui_components_my-card-list.html">$ui/components/sp-card-list</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-card-list.html#~refresh">refresh</a></li></ul></li><li><a href="module-$ui_components_my-cascader.html">$ui/components/sp-cascader</a></li><li><a href="module-$ui_components_my-checkbox.html">$ui/components/sp-checkbox</a></li><li><a href="module-$ui_components_my-clipboard.html">$ui/components/sp-clipboard</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-clipboard.html#~copy">copy</a></li></ul></li><li><a href="module-$ui_components_my-color-picker.html">$ui/components/sp-color-picker</a></li><li><a href="module-$ui_components_my-contextmenu.html">$ui/components/sp-contextmenu</a></li><li><a href="module-$ui_components_my-corner-mark.html">$ui/components/sp-corner-mark</a></li><li><a href="module-$ui_components_my-crud.html">$ui/components/sp-crud</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-crud.html#~openAddDialog">openAddDialog</a></li><li data-type='method'><a href="module-$ui_components_my-crud.html#~refresh">refresh</a></li><li data-type='method'><a href="module-$ui_components_my-crud.html#~reload">reload</a></li></ul></li><li><a href="module-$ui_components_my-date.html">$ui/components/sp-date</a></li><li><a href="module-$ui_components_my-date-picker.html">$ui/components/sp-date-picker</a></li><li><a href="module-$ui_components_my-description.html">$ui/components/sp-description</a></li><li><a href="module-$ui_components_my-detail.html">$ui/components/sp-detail</a></li><li><a href="module-$ui_components_my-detail-item.html">$ui/components/sp-detail-item</a></li><li><a href="module-$ui_components_my-dialog.html">$ui/components/sp-dialog</a></li><li><a href="module-$ui_components_my-drag.html">$ui/components/sp-drag</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-drag.html#~getRelativeEl">getRelativeEl</a></li></ul></li><li><a href="module-$ui_components_my-drop.html">$ui/components/sp-drop</a></li><li><a href="module-$ui_components_my-edit-tags.html">$ui/components/sp-edit-tags</a></li><li><a href="module-$ui_components_my-editor.html">$ui/components/sp-editor</a></li><li><a href="module-$ui_components_my-empty.html">$ui/components/sp-empty</a></li><li><a href="module-$ui_components_my-filter.html">$ui/components/sp-filter</a></li><li><a href="module-$ui_components_my-fixed.html">$ui/components/sp-fixed</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-fixed.html#~resize">resize</a></li></ul></li><li><a href="module-$ui_components_my-flex.html">$ui/components/sp-flex</a></li><li><a href="module-$ui_components_my-flex-item.html">$ui/components/sp-flex-item</a></li><li><a href="module-$ui_components_my-flip.html">$ui/components/sp-flip</a></li><li><a href="module-$ui_components_my-float.html">$ui/components/sp-float</a></li><li><a href="module-$ui_components_my-float-item.html">$ui/components/sp-float-item</a></li><li><a href="module-$ui_components_my-form.html">$ui/components/sp-form</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-form.html#~reset">reset</a></li><li data-type='method'><a href="module-$ui_components_my-form.html#~submit">submit</a></li></ul></li><li><a href="module-$ui_components_my-form_src_Base.html">$ui/components/sp-form/src/Base</a></li><li><a href="module-$ui_components_my-form_src_common_TagInput.html">$ui/components/sp-form/src/common/TagInput</a></li><li><a href="module-$ui_components_my-form_src_common_TagSelect.html">$ui/components/sp-form/src/common/TagSelect</a></li><li><a href="module-$ui_components_my-form_src_common_TreeSelect.html">$ui/components/sp-form/src/common/TreeSelect</a></li><li><a href="module-$ui_components_my-header.html">$ui/components/sp-header</a></li><li><a href="module-$ui_components_my-highlight.html">$ui/components/sp-highlight</a></li><li><a href="module-$ui_components_my-icon.html">$ui/components/sp-icon</a></li><li><a href="module-$ui_components_my-im-wall.html">$ui/components/sp-im-wall</a></li><li><a href="module-$ui_components_my-input.html">$ui/components/sp-input</a></li><li><a href="module-$ui_components_my-input-number.html">$ui/components/sp-input-number</a></li><li><a href="module-$ui_components_my-layout.html">$ui/components/sp-layout</a></li><li><a href="module-$ui_components_my-lazy.html">$ui/components/sp-lazy</a></li><li><a href="module-$ui_components_my-list.html">$ui/components/sp-list</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-list.html#~load">load</a></li><li data-type='method'><a href="module-$ui_components_my-list.html#~refresh">refresh</a></li><li data-type='method'><a href="module-$ui_components_my-list.html#~reset">reset</a></li><li data-type='method'><a href="module-$ui_components_my-list.html#~scrollTop">scrollTop</a></li></ul></li><li><a href="module-$ui_components_my-login.html">$ui/components/sp-login</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-login.html#~submit">submit</a></li></ul></li><li><a href="module-$ui_components_my-marquee.html">$ui/components/sp-marquee</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-marquee.html#~pause">pause</a></li><li data-type='method'><a href="module-$ui_components_my-marquee.html#~start">start</a></li><li data-type='method'><a href="module-$ui_components_my-marquee.html#~stop">stop</a></li></ul></li><li><a href="module-$ui_components_my-master-app.html">$ui/components/sp-master-app</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-master-app.html#~initState">initState</a></li><li data-type='method'><a href="module-$ui_components_my-master-app.html#~onStateChange">onStateChange</a></li><li data-type='method'><a href="module-$ui_components_my-master-app.html#~onStateChange">onStateChange</a></li><li data-type='method'><a href="module-$ui_components_my-master-app.html#~setState">setState</a></li></ul></li><li><a href="module-$ui_components_my-menu.html">$ui/components/sp-menu</a></li><li><a href="module-$ui_components_my-micro-app.html">$ui/components/sp-micro-app</a></li><li><a href="module-$ui_components_my-navbar.html">$ui/components/sp-navbar</a></li><li><a href="module-$ui_components_my-navbar-FullScreenAction.html">$ui/components/sp-navbar-FullScreenAction</a></li><li><a href="module-$ui_components_my-navbar-IconAction.html">$ui/components/sp-navbar-IconAction</a></li><li><a href="module-$ui_components_my-navbar-UserAction.html">$ui/components/sp-navbar-UserAction</a></li><li><a href="module-$ui_components_my-number.html">$ui/components/sp-number</a></li><li><a href="module-$ui_components_my-panel.html">$ui/components/sp-panel</a></li><li><a href="module-$ui_components_my-paragraph.html">$ui/components/sp-paragraph</a></li><li><a href="module-$ui_components_my-pro.html">$ui/components/sp-pro</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-pro.html#~addTab">addTab</a></li><li data-type='method'><a href="module-$ui_components_my-pro.html#~closeTabs">closeTabs</a></li><li data-type='method'><a href="module-$ui_components_my-pro.html#~setTab">setTab</a></li></ul></li><li><a href="module-$ui_components_my-promise.html">$ui/components/sp-promise</a></li><li><a href="module-$ui_components_my-radial-menu.html">$ui/components/sp-radial-menu</a></li><li><a href="module-$ui_components_my-radio.html">$ui/components/sp-radio</a></li><li><a href="module-$ui_components_my-range.html">$ui/components/sp-range</a></li><li><a href="module-$ui_components_my-rate.html">$ui/components/sp-rate</a></li><li><a href="module-$ui_components_my-resize.html">$ui/components/sp-resize</a></li><li><a href="module-$ui_components_my-result.html">$ui/components/sp-result</a></li><li><a href="module-$ui_components_my-revolve.html">$ui/components/sp-revolve</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-revolve.html#~next">next</a></li><li data-type='method'><a href="module-$ui_components_my-revolve.html#~prev">prev</a></li><li data-type='method'><a href="module-$ui_components_my-revolve.html#~start">start</a></li><li data-type='method'><a href="module-$ui_components_my-revolve.html#~stop">stop</a></li></ul></li><li><a href="module-$ui_components_my-select.html">$ui/components/sp-select</a></li><li><a href="module-$ui_components_my-sidebar.html">$ui/components/sp-sidebar</a></li><li><a href="module-$ui_components_my-skeleton.html">$ui/components/sp-skeleton</a></li><li><a href="module-$ui_components_my-slider.html">$ui/components/sp-slider</a></li><li><a href="module-$ui_components_my-sortable.html">$ui/components/sp-sortable</a></li><li><a href="module-$ui_components_my-spin.html">$ui/components/sp-spin</a></li><li><a href="module-$ui_components_my-stat-card.html">$ui/components/sp-stat-card</a></li><li><a href="module-$ui_components_my-switch.html">$ui/components/sp-switch</a></li><li><a href="module-$ui_components_my-table.html">$ui/components/sp-table</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-table.html#~refresh">refresh</a></li></ul></li><li><a href="module-$ui_components_my-tabs.html">$ui/components/sp-tabs</a></li><li><a href="module-$ui_components_my-tag-canvas.html">$ui/components/sp-tag-canvas</a></li><li><a href="module-$ui_components_my-tag-input.html">$ui/components/sp-tag-input</a></li><li><a href="module-$ui_components_my-tag-select.html">$ui/components/sp-tag-select</a></li><li><a href="module-$ui_components_my-text.html">$ui/components/sp-text</a></li><li><a href="module-$ui_components_my-timer.html">$ui/components/sp-timer</a><ul class='methods'><li data-type='method'><a href="module-$ui_components_my-timer.html#~reset">reset</a></li><li data-type='method'><a href="module-$ui_components_my-timer.html#~start">start</a></li><li data-type='method'><a href="module-$ui_components_my-timer.html#~stop">stop</a></li></ul></li><li><a href="module-$ui_components_my-title.html">$ui/components/sp-title</a></li><li><a href="module-$ui_components_my-tree-select.html">$ui/components/sp-tree-select</a></li><li><a href="module-$ui_components_my-typography.html">$ui/components/sp-typography</a></li><li><a href="module-$ui_components_my-water-fall.html">$ui/components/sp-water-fall</a></li><li><a href="module-$ui_components_my-watermark.html">$ui/components/sp-watermark</a></li><li><a href="module-$ui_components_my-wave.html">$ui/components/sp-wave</a></li><li><a href="module-$ui_components_my-wrapper.html">$ui/components/sp-wrapper</a></li><li><a href="module-widgets_my-print.html">widgets/sp-print</a></li></ul><h3>Events</h3><ul><li><a href="module-$ui_components_my-stat-card.html#~event:action">action</a></li><li></li><li><a href="module-$ui_components_my-form_src_common_TagInput.html#~event:add">add</a></li><li><a href="module-$ui_components_my-wrapper.html#~event:back">back</a></li><li><a href="module-$ui_components_my-dialog.html#~event:cancel">cancel</a></li><li><a href="module-$ui_components_my-typography.html#~event:change">change</a></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-radial-menu.html#~event:click">click</a></li><li></li><li></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-avatars.html#~event:click-add">click-add</a></li><li><a href="module-$ui_components_my-avatars.html#~event:click-item">click-item</a></li><li><a href="module-$ui_components_my-avatars.html#~event:click-more">click-more</a></li><li><a href="module-$ui_components_my-radial-menu.html#~event:close">close</a></li><li></li><li><a href="module-$ui_components_my-pro.html#~event:collapse">collapse</a></li><li><a href="module-$ui_components_my-form_src_common_TagSelect.html#~event:collapsed">collapsed</a></li><li><a href="module-$ui_components_my-table.html#~event:column-change">column-change</a></li><li><a href="module-$ui_components_my-navbar-UserAction.html#~event:command">command</a></li><li></li><li></li><li><a href="global.html#event:complete">complete</a></li><li></li><li><a href="module-$ui_components_my-typography.html#event:copy">copy</a></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-drag.html#~event:drag">drag</a></li><li></li><li><a href="module-$ui_components_my-dialog.html#~event:drag-start">drag-start</a></li><li><a href="module-$ui_components_my-dialog.html#~event:drag-stop">drag-stop</a></li><li><a href="module-$ui_components_my-drop.html#~event:drop">drop</a></li><li><a href="module-$ui_components_my-typography.html#event:edited">edited</a></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-typography.html#event:editing">editing</a></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-drop.html#~event:enter">enter</a></li><li><a href="module-$ui_components_my-table.html#~event:error">error</a></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-typography.html#event:expand">expand</a></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-timer.html#~event:finish">finish</a></li><li><a href="module-$ui_components_my-dialog.html#~event:hide">hide</a></li><li><a href="module-$ui_components_my-lazy.html#~event:init">init</a></li><li><a href="module-$ui_components_my-form_src_common_TagInput.html#~event:input-change">input-change</a></li><li><a href="module-$ui_components_my-drop.html#~event:leave">leave</a></li><li><a href="module-$ui_components_my-wrapper.html#~event:link-click">link-click</a></li><li><a href="module-$ui_components_my-dialog.html#~event:load">load</a></li><li><a href="module-$ui_components_my-revolve.html#~event:loaded">loaded</a></li><li><a href="module-$ui_components_my-dialog.html#~event:maximize">maximize</a></li><li><a href="module-$ui_components_my-im-wall.html#~event:on-added">on-added</a></li><li><a href="module-$ui_components_my-capture.html#~event:on-capture">on-capture</a></li><li><a href="global.html#event:on-change">on-change</a></li><li><a href="module-$ui_components_my-tag-canvas.html#~event:on-click">on-click</a></li><li><a href="module-$ui_components_my-capture.html#~event:on-output">on-output</a></li><li><a href="module-$ui_components_my-radial-menu.html#~event:open">open</a></li><li></li><li><a href="module-$ui_components_my-drop.html#~event:over">over</a></li><li><a href="global.html#~event:page-change">page-change</a></li><li></li><li></li><li><a href="module-$ui_components_my-login.html#~event:pki">pki</a></li><li><a href="module-$ui_components_my-revolve.html#~event:progress">progress</a></li><li><a href="module-$ui_components_my-form_src_common_TagInput.html#~event:remove">remove</a></li><li><a href="module-$ui_components_my-timer.html#~event:reset">reset</a></li><li></li><li><a href="module-$ui_components_my-resize.html#~event:resize">resize</a></li><li></li><li><a href="module-$ui_components_my-dialog.html#~event:resize-start">resize-start</a></li><li><a href="module-$ui_components_my-dialog.html#~event:resize-stop">resize-stop</a></li><li><a href="module-$ui_components_my-sidebar.html#~event:select">select</a></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-dialog.html#~event:show">show</a></li><li><a href="global.html#~event:size-change">size-change</a></li><li></li><li></li><li><a href="module-$ui_components_my-timer.html#~event:start">start</a></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-timer.html#~event:stop">stop</a></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-login.html#~event:submit">submit</a></li><li></li><li></li><li><a href="module-$ui_components_my-table.html#~event:success">success</a></li><li></li><li></li><li></li><li></li><li></li><li><a href="module-$ui_components_my-panel.html#~event:tab-change">tab-change</a></li><li><a href="module-$ui_components_my-pro.html#~event:tab-remove">tab-remove</a></li><li><a href="module-$ui_components_my-pro.html#~event:tab-select">tab-select</a></li><li><a href="module-$ui_components_my-timer.html#~event:tick">tick</a></li><li><a href="module-$ui_components_my-form.html#~event:validate">validate</a></li><li><a href="module-widgets_my-back-top.html#event:click">click</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AddShadowToImage">AddShadowToImage</a></li><li><a href="global.html#appendChildNode">appendChildNode</a></li><li><a href="global.html#createEllipsisContainer">createEllipsisContainer</a></li><li><a href="global.html#createEllipsisContentHolder">createEllipsisContentHolder</a></li><li><a href="global.html#destroyVue">destroyVue</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#inRange">inRange</a></li><li><a href="global.html#instanceVue">instanceVue</a></li><li><a href="global.html#props">props</a></li><li><a href="global.html#pxToNumber">pxToNumber</a></li><li><a href="global.html#removeEllipsisContainer">removeEllipsisContainer</a></li><li><a href="global.html#RoundImage">RoundImage</a></li><li><a href="global.html#scrollTop">scrollTop</a></li><li><a href="global.html#setData">setData</a></li><li><a href="global.html#styleToString">styleToString</a></li><li><a href="global.html#wrapperDecorations">wrapperDecorations</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">sp-print/src/Print.vue</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>&lt;!-- 页面打印组件 -->
&lt;template>
  &lt;span @click="handlePrint">
    &lt;slot name="button">
      &lt;el-button :type="type" :class="btnClass">{{text}}&lt;/el-button>
    &lt;/slot>
  &lt;/span>
&lt;/template>
&lt;script>
import {
  addClass,
  removeClass,
  hasClass,
  setStyle
} from 'element-ui/lib/utils/dom'
/**
 * spPrint
 * @module widgets/sp-print
 * @author 李国师
 * @example
 *
 * // 使用说明
 *  &lt;sp-print print-range=".pring-range1">
 *  &lt;/sp-print>
 *
 * // ----------或使用slot-------
 *
 *  &lt;sp-print print-range=".pring-range1">
 *    &lt;el-button type="primary" icon="el-icon-tickets" slot="button">&lt;/el-button>
 *  &lt;/sp-print>
 */
/**
 * 作用域插槽
 * @member slot
 * @property {string} [button] 自定义按钮
 */
export default {
  name: 'spPrint',
  /**
   * 属性参数
   * @member
   * @property {String} [text = '打印'] 按钮文字
   * @property {String} [type = 'default'] 按钮类型
   * @property {String} [btnClass] 按钮样式名称
   * @property {String} [printRange] 打印区域，css选择器，该参数为必须
   * @property {String} [containerClass = 'sp-print-page-container'] 打印内容的容器className
   * @property {Function | HTMLElement | String} [parentDom] 作为父容器的dom对象，或者返回dom对象的方法,dom中必须包含container-class指定的className
   * @property {Object} [rootStyle] 顶层容器的样式,请不要设置position为absolute,relative或static, 否则分页效果会不起作用
   * @property {Function} [beforePrint] 在复制打印区域前执行，须返回promise对象
   * @property {Function} [afterPrint] 在打印完成之后执行
   * @property {String} [removeSelector] 打印时需要删除的元素选择器
   * @property {Array} [styleArray] 打印时须改变的样式数组，示例:[{selector: '.selector', style: {height: 'auto'}}]
   * @property {Function} [domTransfer] 自定义修改打印内容的方法
   * @property {Boolean} [disableDefaultStyle] 禁用默认样式数组，只使用style-array参数
   * @property {Boolean} [preview] 打印后不删除页面打印内容
   */
  props: {
    text: {
      type: String,
      default: '打印'
    },
    type: {
      type: String,
      default: 'default'
    },
    btnClass: {
      type: String,
      default: ''
    },
    printRange: {
      type: String,
      default: '',
      required: true
    },
    containerClass: {
      type: String,
      default: 'sp-print-page-container'
    },
    parentDom: [HTMLElement, Function, String],
    rootStyle: {
      type: Object,
      default: () => {
        return {}
      }
    },
    beforePrint: Function,
    afterPrint: Function,
    removeSelector: {
      type: String,
      default: ''
    },
    styleArray: {
      type: Array,
      default() {
        return []
      }
    },
    domTransfer: Function,
    disableDefaultStyle: Boolean,
    preview: Boolean
  },
  data() {
    return {
      handle: null,
      tDom: null,
      defaultStyles: [
        {
          selector: '.el-table',
          style: {
            height: 'auto'
          }
        },
        {
          selector: '.el-table__body-wrapper',
          style: {
            height: 'auto'
          }
        }
      ]
    }
  },
  methods: {
    handlePrint() {
      if (this.beforePrint &amp;&amp; typeof this.beforePrint === 'function') {
        this.beforePrint().then(() => {
          // this.print();
          this.cloneDom()
        })
      } else {
        // this.print();
        this.cloneDom()
      }
    },
    domTransferDefault(tDom) {
      // 顶层容器默认的样式，请不要设置position为absolute,relative或static, 否则分页效果会不起作用
      let style = {
        width: '100%',
        'max-width': '1200px',
        'background-color': '#fff',
        padding: '0 80px 0 0',
        'box-sizing': 'border-box'
      }
      // 使用者自行传入的样式，如果有同名样式，会覆盖掉
      if (this.rootStyle) {
        style = Object.assign(style, this.rootStyle)
      }
      setStyle(tDom, style)
      // 在打印之前可能需要删除某些元素，可通过removeSelector传入选择器将其删除
      if (this.removeSelector) {
        const removeDoms = tDom.querySelectorAll(this.removeSelector)
        for (let i = 0; i &lt; removeDoms.length; i++) {
          const item = removeDoms[i]
          if (item) {
            item.parentNode.removeChild(item)
          }
        }
      }
      // 在打印之前可能需要改变某些元素的样式，可以将一个数组通过styleArray传进来
      // 数组格式为 [{selector: '.selector-name',style: {height: 'auto'}}]
      let selectors
      if (!this.disableDefaultStyle) {
        selectors = this.defaultStyles.concat(this.styleArray).concat([
          {
            selector: this.printRange,
            style: {
              height: 'auto'
            }
          }
        ])
      } else {
        selectors = this.styleArray
      }
      // 迭代改变每个打印区域的每个dom元素
      for (let i = 0; i &lt; selectors.length; i++) {
        const elems = tDom.querySelectorAll(selectors[i].selector)
        for (let j = 0; j &lt; elems.length; j++) {
          setStyle(elems[j], selectors[i].style)
        }
      }
      // 如果使用者需要编写自己的转换逻辑，则使用domTransfer参数传递一个处理方法
      let tDomTransfered
      if (this.domTransfer &amp;&amp; typeof this.domTransfer === 'function') {
        tDomTransfered = this.domTransfer(tDom, this)
      } else {
        tDomTransfered = tDom
      }
      if (tDomTransfered) {
        return tDomTransfered
      } else {
        throw new Error('domTransfer方法须返回正确的dom元素')
      }
    },
    removePrintPreview() {
      console.log('remove preview')
      // 将打印区域外的元素重新显示
      const rootElems = document.querySelectorAll('body>*')
      for (let i = 0; i &lt; rootElems.length; i++) {
        removeClass(rootElems[i], 'sp-print-displaynone')
        removeClass(rootElems[i], 'sp-print-hide')
      }
      // 删除打印区域
      document.body.removeChild(this.tDom)
      this.tDom = null
    },
    createDom(innerHTML) {
      const con = document.createElement('div')
      con.innerHTML = innerHTML.toString()
      return con.childNodes[0]
    },
    prependDom(parent, elem) {
      parent.innerHTML = elem.outerHTML + parent.innerHTML
      return parent
    },
    closeAfterPrint() {
      this.handle = document.execCommand('print')
      if (this.handle) {
        // 如果不保留打印预览，则直接删除打印区域
        this.removePrintPreview()
        if (this.afterPrint &amp;&amp; typeof this.afterPrint === 'function') {
          this.afterPrint()
        }
      } else {
        setTimeout(() => {
          this.closeAfterPrint()
        }, 300)
      }
    },
    cloneDom() {
      if (this.printRange) {
        // 将打印区域筛选出来用一个div包裹起来
        const contents = document.querySelectorAll(this.printRange)
        const con = document.createElement('div')
        for (let i = 0; i &lt; contents.length; i++) {
          const cloneElem = contents[i].cloneNode(true)
          // 处理canvas元素，使用原来canvas对象的toDataURL方法生成base64,替换复制dom中的canvas
          const canvas = contents[i].querySelectorAll('canvas')
          const canvasClone = cloneElem.querySelectorAll('canvas')
          for (let j = 0; j &lt; canvas.length; j++) {
            const imgSrc = canvas[j].toDataURL()
            const img = document.createElement('img')
            img.src = imgSrc
            canvasClone[j].parentNode.replaceChild(img, canvasClone[j])
          }
          // 添加分页符样式，最后一页不加分页符，否则如果最后一页占满了，会多出一页空白页
          if (i !== contents.length - 1) {
            addClass(cloneElem, 'sp-print-page-break')
          }
          // 将复制的打印区域添加到容器中
          con.appendChild(cloneElem)
        }
        // 使用一个容器再包裹，方便后面移除
        const tDom = document.createElement('div')
        // tDom.id = 'body-print-range';
        // 在顶层容器和打印内容之间可以添加DOM元素，但需指定打印内容所在的class名称
        if (this.parentDom) {
          let parentDom
          let parentCon
          if (this.parentDom instanceof HTMLElement) {
            parentDom = this.parentDom
          } else if (this.parentDom instanceof Function) {
            parentDom = this.parentDom()
          } else if (typeof this.parentDom === 'string') {
            parentDom = this.createDom(this.parentDom)
          } else {
            throw new Error('parent-dom必须为dom元素')
          }
          if (!(parentDom instanceof HTMLElement)) {
            throw new Error('parent-dom参数格式错误，无法生成合法的dom')
          }
          // 如果parentDom包含有container-class指定的类，则本身作为容器，否则查找内部是否有该类
          if (hasClass(parentDom, this.containerClass)) {
            parentCon = parentDom
          } else {
            parentCon = parentDom.querySelector('.' + this.containerClass)
          }
          if (parentCon) {
            parentCon.appendChild(con)
            tDom.appendChild(parentDom)
          } else {
            throw new Error('没找到父容器，检查是否缺少container-class参数')
          }
        } else {
          tDom.className = this.containerClass
          tDom.appendChild(con)
        }
        if (tDom) {
          const tDomTransfered = this.domTransferDefault(tDom)
          // body 下的元素都添加my-print-hide样式，打印时隐藏
          const rootElems = document.querySelectorAll('body>*')
          for (let i = 0; i &lt; rootElems.length; i++) {
            addClass(rootElems[i], 'sp-print-hide')
          }
          this.tDom = tDomTransfered
          // 打印内容添加到body下
          document.body.appendChild(tDomTransfered)
        }
        // 添加打印预览头部
        const previewTitle = this
          .createDom(`&lt;div class="sp-print-preview-title sp-print-hide">
                                                    &lt;span class="title">打印预览&lt;/span>
                                                    &lt;div class="sp-print-preview-close" onclick="handlePrint()">打印&lt;/div>
                                                    &lt;div class="sp-print-preview-close" onclick="closePrintPreview()">关闭&lt;/div>
                                                &lt;/div>`)
        this.prependDom(tDom, previewTitle)

        // 如果尚未注册打印方法，则注册一个
        window.closePrintPreview = () => {
          this.removePrintPreview()
        }
        window.handlePrint = () => {
          this.print()
        }
        // 隐藏除打印区域外的内容
        const rootElems = document.querySelectorAll('body>*')
        for (let i = 0; i &lt; rootElems.length; i++) {
          if(rootElems[i] !== tDom) {
            addClass(rootElems[i], 'sp-print-hide')
            if(this.preview) {
               addClass(rootElems[i], 'sp-print-displaynone')
            }
          }
        }
        addClass(tDom, 'sp-print-visible')
        if (!this.preview) {
          addClass(tDom, 'sp-print-displaynone')
        }
        // 如果不预览直接打印
        if (!this.preview) {
          this.print()
        }
      }
    },
    print() {
      if (this.printRange) {
        setTimeout(() => {
          this.closeAfterPrint()
        }, 20)
      } else {
        window.print()
      }
    }
  }
}
&lt;/script>
</code></pre>
        </article>
    </section>





    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Thu Sep 24 2020 11:07:48 GMT+0800 (China Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>




<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c4e5f73318b5cb0c389e3d9a05f831cc";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

</body>
</html>
